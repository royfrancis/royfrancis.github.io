<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.1">Jekyll</generator><link href="https://royfrancis.com/feed.xml" rel="self" type="application/atom+xml" /><link href="https://royfrancis.com/" rel="alternate" type="text/html" /><updated>2022-01-14T23:36:03+01:00</updated><id>https://royfrancis.com/feed.xml</id><title type="html">rmf</title><subtitle>Code, Photography, Design</subtitle><author><name>Roy Francis</name></author><entry><title type="html">Exploring history and culture in Thessaloniki</title><link href="https://royfrancis.com/greece-thessaloniki/" rel="alternate" type="text/html" title="Exploring history and culture in Thessaloniki" /><published>2019-11-07T00:00:00+01:00</published><updated>2019-11-07T00:00:00+01:00</updated><id>https://royfrancis.com/greece-thessaloniki</id><content type="html" xml:base="https://royfrancis.com/greece-thessaloniki/"><![CDATA[<p>I took a short autumn trip to Thessaloniki, Greece.</p>

<!-- image gallery using freewall and lightbox -->

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<div class="pixture-parent">
<div class="pixture-gallery">
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972177982"> 
          <a href="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191103-_DSC8737-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191103-_DSC8737-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972177982"> 
          <a href="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191105-_DSC8742-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191105-_DSC8742-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972177982"> 
          <a href="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191105-_DSC8744-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191105-_DSC8744-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972177982"> 
          <a href="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191105-_DSC8762-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191105-_DSC8762-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972177982"> 
          <a href="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191105-_DSC8774-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191105-_DSC8774-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972177982"> 
          <a href="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191105-_DSC8783-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191105-_DSC8783-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972177982"> 
          <a href="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191105-_DSC8788-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191105-_DSC8788-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972177982"> 
          <a href="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191105-_DSC8791-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-11-07-greece-thessaloniki/gallery/20191105-_DSC8791-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</div>

  <figcaption>
    Views of Thessaloniki and Platamon.

  </figcaption>

</div>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972177982 a'});
</script>

<p>This place is most interesting for it’s culture and history. You can learn all about the Greek civilisation and the evolution of human civilisation in general. Some of my favourite musuems were the <a href="https://www.amth.gr/">Archaeological Museum of Thessaloniki</a>, <a href="https://warmuseum.gr/">War Museum of Thessaloniki</a> and the <a href="http://www.lpth.gr/">white tower museum</a>. The Museum of Byzantine Culture was unfortunately closed. There are numerous historical churches and archaeological sites scattered through the city.</p>

<p>There are a few places to get some great views of the city. The white tower museum is the most obvious, but it is not that high. The <a href="https://www.skyline.bar/">skyline cafe bar</a> offers excellent 360 degree views of the city as you stuff your pie-hole. Another site is the Trigonion Tower which offers stunning views over the whole city.</p>

<p>On the last day, I took a train ride down to Platamon which is about 1.5 hrs away from Thessaloniki. The beaches were practically empty in November and to be fair, it wasn’t very warm to be in the water. But, I had an excellent fried fish dinner at a local restaurant.</p>]]></content><author><name>Roy Francis</name></author><category term="[&quot;Photography&quot;, &quot;Travel&quot;]" /><category term="Greece" /><summary type="html"><![CDATA[A short weekend away in Thessaloniki, Greece.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://royfrancis.com/assets/images/posts/2019/2019-11-07-greece-thessaloniki/featured.jpg" /><media:content medium="image" url="https://royfrancis.com/assets/images/posts/2019/2019-11-07-greece-thessaloniki/featured.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Scatterplot annotation</title><link href="https://royfrancis.com/scatterplot-annotation/" rel="alternate" type="text/html" title="Scatterplot annotation" /><published>2019-09-17T00:00:00+02:00</published><updated>2019-09-17T00:00:00+02:00</updated><id>https://royfrancis.com/scatterplot-annotation</id><content type="html" xml:base="https://royfrancis.com/scatterplot-annotation/"><![CDATA[<p>In this post, we are exploring ideas to mark clusters of points on a scatterplot for labelling purposes. Or in other words, how to draw polygons around scatterplots. We use ggplot2 for plotting and few different functions to generate the markings. The required packages are shown below. A custom ggplot2 theme is used to simplify the plot.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggforce</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggalt</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span><span class="w">

</span><span class="n">theme_custom</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">basesize</span><span class="o">=</span><span class="m">14</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="n">basesize</span><span class="p">)</span><span class="w"> </span><span class="o">%+replace%</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="w">
      </span><span class="n">panel.border</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
      </span><span class="n">panel.grid</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
      </span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"top"</span><span class="p">,</span><span class="w">
      </span><span class="n">legend.direction</span><span class="o">=</span><span class="s2">"horizontal"</span><span class="p">,</span><span class="w">
      </span><span class="n">legend.justification</span><span class="o">=</span><span class="s2">"right"</span><span class="p">,</span><span class="w">
      </span><span class="n">strip.background</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
      </span><span class="n">axis.ticks</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
      </span><span class="n">axis.title</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
      </span><span class="n">axis.text</span><span class="o">=</span><span class="n">element_blank</span><span class="p">()</span><span class="w">
    </span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>We are using the <strong>iris</strong> dataset using the three different species as groups/clusters.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iris</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_custom</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972109002">
    <a href="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-5-1.png">
      <img src="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-5-1.png" alt="figure" />
    </a>
  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972109002 a'});
</script>

<h1 id="base">Base</h1>

<p>First we start by using base functions.</p>

<h2 id="ellipse">Ellipse</h2>

<p>Perhaps the easiest approach is drawing confidence ellipse. All points are not guaranteed to be inside the ellipse. The default level is 0.95. Increasing this includes more of the points, but the ellipses may get too large. The nice thing about this approach is that it is not strongly affected by outliers. This is well suited for clusters where points have a large spread and overlap a lot.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">stat_ellipse</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="m">0.95</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_custom</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972168827"><a href="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-6-1.png" title="&lt;b&gt;Fig. 1&lt;/b&gt;: Clusters marked by 95% confidence ellipse.">
      <img src="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-6-1.png" alt="clusters-95" />
    </a>
    <figcaption>
    <b>Fig. 1</b>: Clusters marked by 95% confidence ellipse.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972168827 a'});
</script>

<p>For most part, this is the easiest approach and good enough.</p>

<h2 id="convex-hull">Convex hull</h2>

<p>The outermost points in a point cloud can be connected to form a polygon referred to as the convex hull of a point cloud. The convex hull can be computed using the base function <code class="language-plaintext highlighter-rouge">chull()</code>. This can be used in a dplyr pipeline as shown below.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hull</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">iris</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
 </span><span class="n">group_by</span><span class="p">(</span><span class="n">Species</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
 </span><span class="n">slice</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">chull</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">),</span><span class="w">
         </span><span class="n">chull</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span><span class="w">
</span></code></pre></div></div>

<p>The information to draw polygons around all three clusters is contained in the data.frame <strong>hull</strong>. The points and the polygons can be plotted as shown below.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_path</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">hull</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_custom</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972191690"><a href="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-8-1.png" title="&lt;b&gt;Fig. 2&lt;/b&gt;: Clusters marked by convex hull.">
      <img src="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-8-1.png" alt="clusters-95" />
    </a>
    <figcaption>
    <b>Fig. 2</b>: Clusters marked by convex hull.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972191690 a'});
</script>

<p>This is a good start, but it would be nicer if the edges of the polygon had smooth edges rather than sharp edges. While we could use some custom script to smooth it, the easier approach is to use from existing packages.</p>

<h2 id="density-and-contours">Density and contours</h2>

<p>Before we move on, another idea from the base functions is to compute a 2D kernal density from the point cloud and draw countour lines.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iris</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_density_2d</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_custom</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-2022011423360333036297262764"><a href="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-9-1.png" title="&lt;b&gt;Fig. 3&lt;/b&gt;: Contour lines.">
      <img src="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-9-1.png" alt="clusters-95" />
    </a>
    <figcaption>
    <b>Fig. 3</b>: Contour lines.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297262764 a'});
</script>

<h1 id="ggalt">ggalt</h1>
<h2 id="geom_encircle">geom_encircle</h2>

<p>We use the function <code class="language-plaintext highlighter-rouge">geom_encircle()</code> from package <code class="language-plaintext highlighter-rouge">ggalt</code> to draw smoothed lines around clusters.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">ggalt</span><span class="o">::</span><span class="n">geom_encircle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">1.6</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_custom</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972185528"><a href="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-10-1.png" title="&lt;b&gt;Fig. 4&lt;/b&gt;: Clusters encircled using geom_encircle.">
      <img src="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-10-1.png" alt="clusters-encircle" />
    </a>
    <figcaption>
    <b>Fig. 4</b>: Clusters encircled using geom_encircle.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972185528 a'});
</script>

<h1 id="ggforce">ggforce</h1>

<p>Another useful package for marking clusters is <code class="language-plaintext highlighter-rouge">ggforce</code>. Below is a demonstration of four functions for marking clusters. The four functions are <code class="language-plaintext highlighter-rouge">geom_mark_rect()</code>, <code class="language-plaintext highlighter-rouge">geom_mark_circle()</code>, <code class="language-plaintext highlighter-rouge">geom_mark_ellipse()</code> and <code class="language-plaintext highlighter-rouge">geom_mark_hull()</code>. The shapes they create is self-explanatory.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_mark_rect</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_custom</span><span class="p">()</span><span class="w">

</span><span class="n">p2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_mark_circle</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_custom</span><span class="p">()</span><span class="w">

</span><span class="n">p3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_mark_ellipse</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_custom</span><span class="p">()</span><span class="w">

</span><span class="n">p4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_mark_hull</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_custom</span><span class="p">()</span><span class="w">

</span><span class="n">ggpubr</span><span class="o">::</span><span class="n">ggarrange</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="p">,</span><span class="w"> </span><span class="n">p3</span><span class="p">,</span><span class="w"> </span><span class="n">p4</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">common.legend</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-2022011423360333036297244602"><a href="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-11-1.png" title="&lt;b&gt;Fig. 5&lt;/b&gt;: Clusters demarcated using rectangles (top-left), circles (top-right), ellipses (bottom-left) and smoothed convex hull (bottom-right).">
      <img src="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-11-1.png" alt="clusters-4x4" />
    </a>
    <figcaption>
    <b>Fig. 5</b>: Clusters demarcated using rectangles (top-left), circles (top-right), ellipses (bottom-left) and smoothed convex hull (bottom-right).

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297244602 a'});
</script>

<p><code class="language-plaintext highlighter-rouge">geom_mark_hull()</code> has extra arguments to control concavity, radius and size (expand) of the hull shape. <code class="language-plaintext highlighter-rouge">geom_mark_*</code> functions also support an argument <code class="language-plaintext highlighter-rouge">label</code> to label the the marks. In this case, the plot legend can be turned off.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_mark_ellipse</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">Species</span><span class="p">),</span><span class="w"> </span><span class="n">label.colour</span><span class="o">=</span><span class="s2">"grey30"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_custom</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972149466"><a href="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-12-1.png" title="&lt;b&gt;Fig. 6&lt;/b&gt;: Clusters marked and labelled using `geom_mark_ellipse()`.">
      <img src="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-12-1.png" alt="clusters-4x4" />
    </a>
    <figcaption>
    <b>Fig. 6</b>: Clusters marked and labelled using <code class="language-plaintext highlighter-rouge">geom_mark_ellipse()</code>.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972149466 a'});
</script>

<p>It is not necessary to mark all the groups. A particular group of interest can be marked alone.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_mark_ellipse</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">filter</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">Species</span><span class="o">==</span><span class="s2">"setosa"</span><span class="p">),</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="n">Species</span><span class="p">),</span><span class="w"> </span><span class="n">label.colour</span><span class="o">=</span><span class="s2">"grey30"</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="s2">"This is a brief description about this annotation."</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_custom</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>For more control over text annotation, see package <a href="https://cran.r-project.org/web/packages/ggrepel/vignettes/ggrepel.html">ggrepel</a>.</p>

<p>The <code class="language-plaintext highlighter-rouge">ggforce</code> package also has a function called <code class="language-plaintext highlighter-rouge">geom_shape()</code> to draw polygons but with some neat features. We can adjust the corner radius of the polygon to smooth the edges. We can also increase or decrease the overall size of the polygon. In this case, we use the convex hull object <strong>hull</strong> which we computed earlier.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_shape</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">hull</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="kc">NA</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_custom</span><span class="p">()</span><span class="w">
</span><span class="n">p2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_shape</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">hull</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="o">=</span><span class="m">0.05</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_custom</span><span class="p">()</span><span class="w">
</span><span class="n">p3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">iris</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_shape</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">hull</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Petal.Length</span><span class="p">,</span><span class="w"> </span><span class="n">Petal.Width</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Species</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="o">=</span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">expand</span><span class="o">=</span><span class="m">0.04</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_custom</span><span class="p">()</span><span class="w">
</span><span class="n">ggpubr</span><span class="o">::</span><span class="n">ggarrange</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="p">,</span><span class="w"> </span><span class="n">p3</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">common.legend</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972152641"><a href="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-14-1.png" title="&lt;b&gt;Fig. 8&lt;/b&gt;: Clusters marked using manually computed convex hull. geom_shape from ggforce is used. Standard convex hull (top-left), smoothed edges (top-right) and smoothed+enlarged (bottom-left).">
      <img src="/assets/images/posts/2019/2019-09-17-scatterplot-annotation/figure/unnamed-chunk-14-1.png" alt="clusters-14" />
    </a>
    <figcaption>
    <b>Fig. 8</b>: Clusters marked using manually computed convex hull. geom_shape from ggforce is used. Standard convex hull (top-left), smoothed edges (top-right) and smoothed+enlarged (bottom-left).

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972152641 a'});
</script>

<p>The package <code class="language-plaintext highlighter-rouge">ggforce</code> has many more cool features. You should check out their <a href="https://ggforce.data-imaginist.com/">website</a>.</p>]]></content><author><name>Roy Francis</name></author><category term="[&quot;Code&quot;, &quot;Research&quot;]" /><category term="Data Visualisation" /><category term="Heatmap" /><category term="R" /><category term="Scientific Graphs" /><summary type="html"><![CDATA[Annotating scatterplots in R. Drawing polygons around point clusters using base functions and R packages ggplot, ggalt and ggforce.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://royfrancis.com/assets/images/posts/2019/2019-09-17-scatterplot-annotation/featured.jpg" /><media:content medium="image" url="https://royfrancis.com/assets/images/posts/2019/2019-09-17-scatterplot-annotation/featured.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Exploring the Swedish west coast</title><link href="https://royfrancis.com/sweden-west-coast/" rel="alternate" type="text/html" title="Exploring the Swedish west coast" /><published>2019-08-22T00:00:00+02:00</published><updated>2019-08-22T00:00:00+02:00</updated><id>https://royfrancis.com/sweden-west-coast</id><content type="html" xml:base="https://royfrancis.com/sweden-west-coast/"><![CDATA[<!-- image gallery using freewall and lightbox -->

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<div class="pixture-parent">
<div class="pixture-gallery">
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972144024"> 
          <a href="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190817-_DSC7778.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190817-_DSC7778.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972144024"> 
          <a href="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190817-_DSC7785.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190817-_DSC7785.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972144024"> 
          <a href="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190817-_DSC7820.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190817-_DSC7820.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972144024"> 
          <a href="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190817-_DSC7838.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190817-_DSC7838.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972144024"> 
          <a href="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190819-DJI_0144.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190819-DJI_0144.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972144024"> 
          <a href="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190819-DJI_0157-HDR.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190819-DJI_0157-HDR.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972144024"> 
          <a href="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190819-_DSC7954.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190819-_DSC7954.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972144024"> 
          <a href="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190819-_DSC7975.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190819-_DSC7975.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972144024"> 
          <a href="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190819-_DSC7980.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190819-_DSC7980.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972144024"> 
          <a href="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190820-_DSC8128.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190820-_DSC8128.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972144024"> 
          <a href="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190820-_DSC8146.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190820-_DSC8146.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972144024"> 
          <a href="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190821-_DSC8205.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-08-22-sweden-west-coast/gallery/20190821-_DSC8205.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</div>

  <figcaption>
    Views from the west coast of Sweden.

  </figcaption>

</div>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972144024 a'});
</script>

<p>The west coast of Sweden is well known for it’s <a href="https://visitsweden.com/where-to-go/southern-sweden/vastsverige/west-coast-archipelago/">rocky archipelago</a> and scenic beauty. Also known for seafood, sea kayaking and floating saunas. I took a trip through Lidköping and Trollhättan to Lysekil, Fjällbacka and Grebbestad.</p>

<p>In Trollhättan, the <a href="https://saabcarmuseum.se/en/">Saab car museum</a>, Trollhättan canal and Olidan power station were interesting. About 30 mins north of Lysekil is the animal park <a href="https://nordensark.se/">Nordens ark</a>. It’s a fun place if you are into animals.</p>

<p>I slowly drove around between Lysekil and Grebbestad stopping at every scenic spot. There are also many camping spots around the area which makes it convenient. I stayed at Fjällbacka camping for one of the nights was a really cute campsite with glorious views over the archipelago.</p>]]></content><author><name>Roy Francis</name></author><category term="[&quot;Photography&quot;, &quot;Travel&quot;]" /><category term="Sweden" /><category term="Road Trip" /><summary type="html"><![CDATA[A road trip exploring the west coast of Sweden.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://royfrancis.com/assets/images/posts/2019/2019-08-22-sweden-west-coast/featured.jpg" /><media:content medium="image" url="https://royfrancis.com/assets/images/posts/2019/2019-08-22-sweden-west-coast/featured.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Road trip through Portugal</title><link href="https://royfrancis.com/portugal/" rel="alternate" type="text/html" title="Road trip through Portugal" /><published>2019-06-30T00:00:00+02:00</published><updated>2019-06-30T00:00:00+02:00</updated><id>https://royfrancis.com/portugal</id><content type="html" xml:base="https://royfrancis.com/portugal/"><![CDATA[<p>I attended the Elixir hands-on meeting in Lisbon, Portugal this summer. This gave me an opportunity to visit Lisbon and take a road trip through Portugal.</p>

<p>I had never been to Lisbon before, so I wasn’t exactly sure what to expect. But, Lisbon was absolutely lovely. The weather was not too hot and the cute winding streets were charming and bustling with people. Parts of the city are hilly and scenic viewpoints are everywhere. The city is full of historic buildings, museums, restaurants and cafes. I thought the Maritime museum was very interesting. The food was reasonably priced and delicious. I also happened to be in perfect time for the Lisbon street festivals which meant that there were parties and dancing in the streets almost all through the city.</p>

<!-- image gallery using freewall and lightbox -->

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<div class="pixture-parent">
<div class="pixture-gallery">
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297246289"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_lisbon/20190620-_DSC6911-HDR-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_lisbon/20190620-_DSC6911-HDR-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297246289"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_lisbon/20190620-_DSC6914-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_lisbon/20190620-_DSC6914-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297246289"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_lisbon/20190620-_DSC6920-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_lisbon/20190620-_DSC6920-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297246289"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_lisbon/20190621-_DSC6936-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_lisbon/20190621-_DSC6936-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297246289"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_lisbon/20190627-_DSC7337.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_lisbon/20190627-_DSC7337.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</div>

  <figcaption>
    Views of Lisbon.

  </figcaption>

</div>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297246289 a'});
</script>

<p>After the conference, I rented a car and drove down South to Algarve exploring the countryside.</p>

<!-- image gallery using freewall and lightbox -->

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<div class="pixture-parent">
<div class="pixture-gallery">
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297250015"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_countryside/20190622-_DSC6976-HDR-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_countryside/20190622-_DSC6976-HDR-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297250015"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_countryside/20190623-_DSC7033.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_countryside/20190623-_DSC7033.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297250015"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_countryside/20190624-_DSC7071-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_countryside/20190624-_DSC7071-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297250015"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_countryside/20190626-DJI_0738.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_countryside/20190626-DJI_0738.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297250015"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_countryside/20190626-_DSC7314.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_countryside/20190626-_DSC7314.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</div>

  <figcaption>
    Views from the countryside.

  </figcaption>

</div>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297250015 a'});
</script>

<p>There are several beautiful sandy beaches along the west coast as well as the South. Few of them that I visited were Praia da Zambujeira do Mar, Praia de Odeceixe, Praia da Cordoama and Praia do Zavial.</p>

<!-- image gallery using freewall and lightbox -->

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<div class="pixture-parent">
<div class="pixture-gallery">
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297220841"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_beach/20190622-_DSC6989-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_beach/20190622-_DSC6989-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297220841"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_beach/20190623-DJI_0306.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_beach/20190623-DJI_0306.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297220841"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_beach/20190624-_DSC7113.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_beach/20190624-_DSC7113.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297220841"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_beach/20190624-_DSC7115.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_beach/20190624-_DSC7115.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-2022011423360333036297220841"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_beach/20190625-_DSC7152.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_beach/20190625-_DSC7152.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</div>

  <figcaption>
    Views of various beaches.

  </figcaption>

</div>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297220841 a'});
</script>

<p>Cape St. Vincent (Farol do Cabo de São Vicente) is the Southwestern tip of Portugal, which also happens to be the most Southwestern point of continental Europe. The lighthouse and rocky cliffs are magnificent. I arrived here in the evening just before sunset. The golden hour was amazing and then out of nowhere, the fog came in. The heavy fog drifting across the cliffs and over the peninsula was an amazing sight from the drone.</p>

<!-- image gallery using freewall and lightbox -->

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<div class="pixture-parent">
<div class="pixture-gallery">
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972172856"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_sao_vincente/20190624-DJI_0563.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_sao_vincente/20190624-DJI_0563.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972172856"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_sao_vincente/20190624-DJI_0566.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_sao_vincente/20190624-DJI_0566.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972172856"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_sao_vincente/20190625-DJI_0655-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_sao_vincente/20190625-DJI_0655-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</div>

  <figcaption>
    Views around Cape St. Vicente.

  </figcaption>

</div>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972172856 a'});
</script>

<p>The coastal areas around Lagos, Portimão and Faro have rather interesting rock formations and cave systems. Some of them are Benagil caves (Algar de Benagil), Marinha beach (Praia da Marinha), Arco de Albandeira and Algar Seco. I stayed in Albufeira for a couple of days to check out the attractions. I also went on a dolphin watching trip which was exciting.</p>

<!-- image gallery using freewall and lightbox -->

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<div class="pixture-parent">
<div class="pixture-gallery">
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972190045"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_algarve/20190625-_DSC7169.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_algarve/20190625-_DSC7169.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972190045"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_algarve/20190625-_DSC7216-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_algarve/20190625-_DSC7216-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972190045"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_algarve/20190625-_DSC7244-min.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_algarve/20190625-_DSC7244-min.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:192px;" id="slb-20220114233603330362972190045"> 
          <a href="/assets/images/posts/2019/2019-06-30-portugal/gallery_algarve/20190625-_DSC7247.jpg">
            <img class="pixture-img" style="height:192px;" src="/assets/images/posts/2019/2019-06-30-portugal/gallery_algarve/20190625-_DSC7247.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</div>

  <figcaption>
    Views from Algarve.

  </figcaption>

</div>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972190045 a'});
</script>

<p>If you are into pirates, you should check out the <a href="https://goo.gl/maps/qbAHqWVNwPujHEky5">Pirate shop</a> in Sagres and the <a href="https://www.booking.com/hotel/pt/os-piratas.en-gb.html">Pirate themed B&amp;B</a> in Charneca de Caparica.</p>]]></content><author><name>Roy Francis</name></author><category term="[&quot;Photography&quot;, &quot;Travel&quot;]" /><category term="Portugal" /><category term="Road Trip" /><summary type="html"><![CDATA[A conference and road trip through Portugal.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://royfrancis.com/assets/images/posts/2019/2019-06-30-portugal/featured.jpg" /><media:content medium="image" url="https://royfrancis.com/assets/images/posts/2019/2019-06-30-portugal/featured.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">A guide to elegant tiled heatmaps in R [2019]</title><link href="https://royfrancis.com/a-guide-to-elegant-tiled-heatmaps-in-r-2019/" rel="alternate" type="text/html" title="A guide to elegant tiled heatmaps in R [2019]" /><published>2019-02-17T23:07:48+01:00</published><updated>2019-02-17T23:07:48+01:00</updated><id>https://royfrancis.com/a-guide-to-elegant-tiled-heatmaps-in-r-2019</id><content type="html" xml:base="https://royfrancis.com/a-guide-to-elegant-tiled-heatmaps-in-r-2019/"><![CDATA[<p><strong>This is an update to an older <a href="/a-guide-to-elegant-tiled-heatmaps-in-r">post from 2015</a> on the same topic. This covers the exact same thing but using the latest R packages and coding style using the pipes (<code class="language-plaintext highlighter-rouge">%&gt;%</code> ) and tidyverse packages.</strong></p>

<p>This was inspired by the disease incidence rate in the US featured on the <a href="http://graphics.wsj.com/infectious-diseases-and-vaccines/">Wall Street Journal</a>. The disease incidence dataset was originally used in <a href="http://www.nejm.org/doi/full/10.1056/NEJMms1215400">this article</a> in the New England Journal of Medicine. In this post, I am using the measles level 1 incidence (cases per 100,000 people) dataset obtained as a .csv file from <a href="https://www.tycho.pitt.edu">Project Tycho</a>. Download the .csv file <a href="./measles_lev1.csv">here</a>.</p>

<p>In this post, we will look into creating a neat, clean and elegant heatmap in R. No clustering, no dendrograms, no trace  lines, no bullshit. We will go through some basic data cleanup, reformatting and finally plotting. We go through this step by step. For the whole code with minimal explanations, scroll to the bottom of the page.</p>

<p>I am running R version <strong>3.5.2</strong> 64-bit on Ubuntu 18.04 64-bit. Packages in use are <code class="language-plaintext highlighter-rouge">ggplot2 (3.1.0)</code>, <code class="language-plaintext highlighter-rouge">dplyr (0.7.8)</code>, <code class="language-plaintext highlighter-rouge">tidyr (0.8.2)</code>, <code class="language-plaintext highlighter-rouge">stringr (1.3.1)</code> and for base plots I am using <code class="language-plaintext highlighter-rouge">gplots (3.0.1.1)</code> and <code class="language-plaintext highlighter-rouge">plotrix (3.7-4)</code>. Install the necessary packages if not already installed and load them.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># install packages</span><span class="w">
</span><span class="c1"># install.packages(pkgs = c("ggplot2","dplyr","tidyr","stringr","gplots","plotrix"),dependencies = T)</span><span class="w">

</span><span class="c1"># load packages</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w"> </span><span class="c1"># ggplot() for plotting</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w"> </span><span class="c1"># data reformatting</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w"> </span><span class="c1"># data reformatting</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w"> </span><span class="c1"># string manipulation</span><span class="w">
</span></code></pre></div></div>
<h2 id="1-data-preparation">1. Data preparation</h2>

<p>Read in the .csv file and inspect the data. The first two rows with non-table data is skipped.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># read csv file</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"measles_lev1.csv"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="nb">F</span><span class="p">,</span><span class="n">skip</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">

</span><span class="c1"># inspect data</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">m</span><span class="o">$</span><span class="n">YEAR</span><span class="p">)</span><span class="w">
</span><span class="n">table</span><span class="p">(</span><span class="n">m</span><span class="o">$</span><span class="n">WEEK</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">head()</code> function shows us the header names and the first 6 rows of the data. The <code class="language-plaintext highlighter-rouge">str()</code> function shows that <code class="language-plaintext highlighter-rouge">YEAR</code> and <code class="language-plaintext highlighter-rouge">WEEK</code> columns are stored as integers and the incidences as characters. The incidences although numeric have been read in as character because missing values are coded as “-“.  The <code class="language-plaintext highlighter-rouge">table()</code> function is used to check for any missing years or weeks. The data is currently stored in so called ‘wide’ format which we will convert to ‘long’ format. The <code class="language-plaintext highlighter-rouge">ggplot2</code> plotting package prefers long format. The wide format is shown below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; head(m)
YEAR WEEK ALABAMA ALASKA ARIZONA ARKANSAS CALIFORNIA COLORADO
1 1928    1    3.67      -    1.90     4.11       1.38     8.38
2 1928    2    6.25      -    6.40     9.91       1.80     6.02
3 1928    3    7.95      -    4.50    11.15       1.31     2.86
4 1928    4   12.58      -    1.90    13.75       1.87    13.71
5 1928    5    8.03      -    0.47    20.79       2.38     5.13
6 1928    6    7.27      -    6.40    26.58       2.79     8.09
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">YEAR</code>and <code class="language-plaintext highlighter-rouge">WEEK</code> variables are kept as is and all incidence values are collapsed into a variable and value column. The column names are changed to lower case for convenience. The year and week variables are converted to factors and value variable is converted to a number.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># convert data to long format</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">"state"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="s2">"value"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">YEAR</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">WEEK</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># rename columns</span><span class="w">
  </span><span class="n">setNames</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"year"</span><span class="p">,</span><span class="w"> </span><span class="s2">"week"</span><span class="p">,</span><span class="w"> </span><span class="s2">"state"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># convert year to factor</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">year</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># convert week to factor</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">week</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">week</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># convert value to numeric (also converts '-' to NA, gives a warning)</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>The output in long format is shown below.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="w"> </span><span class="n">head</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span><span class="w">
  </span><span class="n">year</span><span class="w"> </span><span class="n">week</span><span class="w">   </span><span class="n">state</span><span class="w"> </span><span class="n">value</span><span class="w">
</span><span class="m">1</span><span class="w"> </span><span class="m">1928</span><span class="w">    </span><span class="m">1</span><span class="w"> </span><span class="n">Alabama</span><span class="w">  </span><span class="m">3.67</span><span class="w">
</span><span class="m">2</span><span class="w"> </span><span class="m">1928</span><span class="w">    </span><span class="m">2</span><span class="w"> </span><span class="n">Alabama</span><span class="w">  </span><span class="m">6.25</span><span class="w">
</span><span class="m">3</span><span class="w"> </span><span class="m">1928</span><span class="w">    </span><span class="m">3</span><span class="w"> </span><span class="n">Alabama</span><span class="w">  </span><span class="m">7.95</span><span class="w">
</span><span class="m">4</span><span class="w"> </span><span class="m">1928</span><span class="w">    </span><span class="m">4</span><span class="w"> </span><span class="n">Alabama</span><span class="w"> </span><span class="m">12.58</span><span class="w">
</span><span class="m">5</span><span class="w"> </span><span class="m">1928</span><span class="w">    </span><span class="m">5</span><span class="w"> </span><span class="n">Alabama</span><span class="w">  </span><span class="m">8.03</span><span class="w">
</span><span class="m">6</span><span class="w"> </span><span class="m">1928</span><span class="w">    </span><span class="m">6</span><span class="w"> </span><span class="n">Alabama</span><span class="w">  </span><span class="m">7.27</span><span class="w">
</span></code></pre></div></div>

<p>The <strong>state</strong> variable is currently in all caps and multi-word states have dot separators. I prefer to have them in Title Case and separated by space to be shown on the plot later. A custom function is used to change the states into Title Case. Multi-word states are split at the dot separator and each word is changed into Title Case using the function <code class="language-plaintext highlighter-rouge">str_to_title()</code> and they are pasted back together.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># removes . and change states to title case using custom function</span><span class="w">
</span><span class="n">fn_tc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">str_to_title</span><span class="p">(</span><span class="n">unlist</span><span class="p">(</span><span class="n">strsplit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s2">"[.]"</span><span class="p">))),</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s2">" "</span><span class="p">)</span><span class="w">
</span><span class="n">m2</span><span class="o">$</span><span class="n">state</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">m2</span><span class="o">$</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">fn_tc</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now, I would like to plot the heatmap with the year on the x-axis and state on the y-axis, which means we have to deal with the <strong>week</strong> variable in some way. We will sum all the incidences from all weeks for each year and discard the <strong>week</strong> variable. The dplyr compliant way to do this is to use <code class="language-plaintext highlighter-rouge">group_by()</code> followed by <code class="language-plaintext highlighter-rouge">summarise()</code> using a function.</p>

<p>The way <code class="language-plaintext highlighter-rouge">sum()</code> handles <code class="language-plaintext highlighter-rouge">NA</code>s is a bit strange. By default, it returns <code class="language-plaintext highlighter-rouge">NA</code> if one or more elements in the input vector is <code class="language-plaintext highlighter-rouge">NA</code>. If we set argument <code class="language-plaintext highlighter-rouge">na.rm=TRUE</code>, then <code class="language-plaintext highlighter-rouge">NA</code>s are removed and the remaining numbers are summed. But if all the elements are <code class="language-plaintext highlighter-rouge">NA</code>, the sum is returned as zero. This is weird and undesirable in this situation. Therefore, I have a custom sum function named <code class="language-plaintext highlighter-rouge">na_sum()</code> to remove <code class="language-plaintext highlighter-rouge">NA</code>s and return the remaining sum or return <code class="language-plaintext highlighter-rouge">NA</code> if all elements are <code class="language-plaintext highlighter-rouge">NA</code>. We then use this custom function inside <code class="language-plaintext highlighter-rouge">summarise()</code> function to summarise the data by year and state while getting rid of week.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># custom sum function returns NA when all values in set are NA,</span><span class="w">
</span><span class="c1"># in a set mixed with NAs, NAs are removed and remaining summed.</span><span class="w">
</span><span class="n">na_sum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="nf">all</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">all</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># sum incidences for all weeks into one year</span><span class="w">
</span><span class="n">m3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">na_sum</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">as.data.frame</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p>Now our data looks like this without the <strong>week</strong> variable. The values are summed by year for each state to create a new variable <strong>count</strong>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="w"> </span><span class="n">head</span><span class="p">(</span><span class="n">m3</span><span class="p">)</span><span class="w">

  </span><span class="n">year</span><span class="w">      </span><span class="n">state</span><span class="w">  </span><span class="n">count</span><span class="w">
</span><span class="m">1</span><span class="w"> </span><span class="m">1928</span><span class="w">    </span><span class="n">Alabama</span><span class="w"> </span><span class="m">334.99</span><span class="w">
</span><span class="m">2</span><span class="w"> </span><span class="m">1928</span><span class="w">     </span><span class="n">Alaska</span><span class="w">   </span><span class="m">0.00</span><span class="w">
</span><span class="m">3</span><span class="w"> </span><span class="m">1928</span><span class="w">    </span><span class="n">Arizona</span><span class="w"> </span><span class="m">200.75</span><span class="w">
</span><span class="m">4</span><span class="w"> </span><span class="m">1928</span><span class="w">   </span><span class="n">Arkansas</span><span class="w"> </span><span class="m">481.77</span><span class="w">
</span><span class="m">5</span><span class="w"> </span><span class="m">1928</span><span class="w"> </span><span class="n">California</span><span class="w">  </span><span class="m">69.22</span><span class="w">
</span><span class="m">6</span><span class="w"> </span><span class="m">1928</span><span class="w">   </span><span class="n">Colorado</span><span class="w"> </span><span class="m">206.98</span><span class="w">
</span></code></pre></div></div>

<p>At this point, the data preparation is essentially over. The data is in ‘long’ format, the x, y and z variables for the plot are available and are of the correct type: factor, factor and numeric. If your data is already in this format, it is easy to jump straight into visualisation. But depending on what sort of data you start off with, the data preparation and reformatting can be complicated and tedious.</p>

<h2 id="2-plotting">2. Plotting</h2>

<p>I prefer to use the <code class="language-plaintext highlighter-rouge">ggplot2</code> plotting package to plot graphs in R due to its consistent code structure. I will focus mostly on <code class="language-plaintext highlighter-rouge">ggplot2</code> code here. But, just for the sake of completeness, I will also include some heatmap code using base graphics.</p>

<h3 id="21-ggplot2">2.1 ggplot2</h3>

<p>Once the data is in the right format, plotting the data is rather simple code in ggplot2. The <a href="http://docs.ggplot2.org/current/geom_tile.html">ggplot2 index page</a> has the code syntax and arguments.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#basic ggplot</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">m3</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">count</span><span class="p">))</span><span class="o">+</span><span class="w">
      </span><span class="n">geom_tile</span><span class="p">()</span><span class="w">

</span><span class="c1">#save plot to working directory</span><span class="w">
</span><span class="n">ggsave</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="s2">"measles-basic.png"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972152632"><a href="/assets/images/posts/2019/2019-02-17-a-guide-to-elegant-tiled-heatmaps-in-r-2019/measles-basic.png" title="The basic plot produced from ggplot2.">
      <img src="/assets/images/posts/2019/2019-02-17-a-guide-to-elegant-tiled-heatmaps-in-r-2019/measles-basic.png" alt="basic" />
    </a>
    <figcaption>
    The basic plot produced from ggplot2.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972152632 a'});
</script>

<p>The default output from <code class="language-plaintext highlighter-rouge">ggplot2</code> is quite decent- There are several aspects of the basic plot that can be modified and tweaked. We add tile borders, custom x-axis breaks and custom text sizes. The ggplot code is modified below.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#modified ggplot</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">m3</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">count</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="c1">#add border white colour of line thickness 0.25</span><span class="w">
  </span><span class="n">geom_tile</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">0.25</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="c1">#remove x and y axis labels</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="c1">#remove extra space</span><span class="w">
  </span><span class="n">scale_y_discrete</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="c1">#define new breaks on x-axis</span><span class="w">
  </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w">
                    </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"1930"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1940"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1950"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1960"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1970"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1980"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1990"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2000"</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="c1">#set a base size for all fonts</span><span class="w">
  </span><span class="n">theme_grey</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="m">8</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="c1">#theme options</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="w">
    </span><span class="c1">#bold font for legend text</span><span class="w">
    </span><span class="n">legend.text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">face</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">),</span><span class="w">
    </span><span class="c1">#set thickness of axis ticks</span><span class="w">
    </span><span class="n">axis.ticks</span><span class="o">=</span><span class="n">element_line</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">0.4</span><span class="p">),</span><span class="w">
    </span><span class="c1">#remove plot background</span><span class="w">
    </span><span class="n">plot.background</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
    </span><span class="c1">#remove plot border</span><span class="w">
    </span><span class="n">panel.border</span><span class="o">=</span><span class="n">element_blank</span><span class="p">()</span><span class="w">
  </span><span class="p">)</span><span class="w">

</span><span class="c1">#save with dpi 200</span><span class="w">
</span><span class="n">ggsave</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="s2">"measles-mod1.png"</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">5.5</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">8.8</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="o">=</span><span class="s2">"in"</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="o">=</span><span class="m">200</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-2022011423360333036297278969"><a href="/assets/images/posts/2019/2019-02-17-a-guide-to-elegant-tiled-heatmaps-in-r-2019/measles-mod1.png" title="ggplot2 heatmap after customisation.">
      <img src="/assets/images/posts/2019/2019-02-17-a-guide-to-elegant-tiled-heatmaps-in-r-2019/measles-mod1.png" alt="mod1" />
    </a>
    <figcaption>
    ggplot2 heatmap after customisation.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297278969 a'});
</script>

<p>I would prefer the y-axis labels (states) to be ordered ascending top-bottom. This means going back to our ‘long’ format data and refactoring the <strong>state</strong> variable in reverse. The fill variable here (<strong>count</strong>) is a continuous variable and hence, ggplot by default uses the blue colour ramp. Here and in many cases, it might make better sense to bin the continuous data into levels and represent each level as a discrete colour. The <code class="language-plaintext highlighter-rouge">cut()</code> function in R allows to break and label a continuous variable.</p>

<p>The <strong>count</strong> variable is binned into 7 levels and saved as a new variable <code class="language-plaintext highlighter-rouge">countfactor</code>. The <code class="language-plaintext highlighter-rouge">NA</code>s remain as <code class="language-plaintext highlighter-rouge">NA</code>. Defining breaks in your variable depends on the type of data, the number of bins that make sense with the context or just trial and error. Too many bins are not good. Checking your variable using <code class="language-plaintext highlighter-rouge">summary(x)</code> or a <code class="language-plaintext highlighter-rouge">boxplot(x)</code> can reveal a lot about the data.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">m3</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># convert state to factor and reverse order of levels</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="n">rev</span><span class="p">(</span><span class="n">sort</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">state</span><span class="p">)))))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># create a new variable from count</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">countfactor</span><span class="o">=</span><span class="n">cut</span><span class="p">(</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)),</span><span class="w">
                          </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0-1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1-10"</span><span class="p">,</span><span class="w"> </span><span class="s2">"10-100"</span><span class="p">,</span><span class="w"> </span><span class="s2">"100-500"</span><span class="p">,</span><span class="w"> </span><span class="s2">"500-1000"</span><span class="p">,</span><span class="w"> </span><span class="s2">"&gt;1000"</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># change level order</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">countfactor</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">countfactor</span><span class="p">),</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="n">rev</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">countfactor</span><span class="p">))))</span><span class="w">
</span></code></pre></div></div>

<p>Now we are ready to plot the final dataset.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># assign text colour</span><span class="w">
</span><span class="n">textcol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"grey40"</span><span class="w">

</span><span class="c1"># further modified ggplot</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">m4</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">countfactor</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_tile</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">0.2</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">guide_legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Cases per\n100,000 people"</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s2">"Incidence of Measles in the US"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_discrete</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"1930"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1940"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1950"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1960"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1970"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1980"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1990"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2000"</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#d53e4f"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#f46d43"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fdae61"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fee08b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#e6f598"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#abdda4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#ddf1da"</span><span class="p">),</span><span class="w"> </span><span class="n">na.value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey90"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="c1">#coord_fixed()+</span><span class="w">
  </span><span class="n">theme_grey</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"right"</span><span class="p">,</span><span class="w"> </span><span class="n">legend.direction</span><span class="o">=</span><span class="s2">"vertical"</span><span class="p">,</span><span class="w">
        </span><span class="n">legend.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="n">textcol</span><span class="p">),</span><span class="w">
        </span><span class="n">legend.margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">grid</span><span class="o">::</span><span class="n">unit</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">)),</span><span class="w">
        </span><span class="n">legend.text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="n">textcol</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">),</span><span class="w">
        </span><span class="n">legend.key.height</span><span class="o">=</span><span class="n">grid</span><span class="o">::</span><span class="n">unit</span><span class="p">(</span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">),</span><span class="w">
        </span><span class="n">legend.key.width</span><span class="o">=</span><span class="n">grid</span><span class="o">::</span><span class="n">unit</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.text.x</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">textcol</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.text.y</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">vjust</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">textcol</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.ticks</span><span class="o">=</span><span class="n">element_line</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">0.4</span><span class="p">),</span><span class="w">
        </span><span class="n">plot.background</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">panel.border</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">plot.margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="m">0.7</span><span class="p">,</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">),</span><span class="w">
        </span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="n">textcol</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span><span class="w">
      </span><span class="p">)</span><span class="w">

</span><span class="c1">#export figure</span><span class="w">
</span><span class="n">ggsave</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="s2">"measles-mod3.png"</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">5.5</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">8.8</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="o">=</span><span class="s2">"in"</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="o">=</span><span class="m">200</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972127795"><a href="/assets/images/posts/2019/2019-02-17-a-guide-to-elegant-tiled-heatmaps-in-r-2019/measles-mod2.png" title="Further customisation of the ggplot2 heatmap.">
      <img src="/assets/images/posts/2019/2019-02-17-a-guide-to-elegant-tiled-heatmaps-in-r-2019/measles-mod2.png" alt="mod2" />
    </a>
    <figcaption>
    Further customisation of the ggplot2 heatmap.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972127795 a'});
</script>

<p>This is the final version of the figure. All font elements are coloured <code class="language-plaintext highlighter-rouge">grey40</code>.  Missing values (<code class="language-plaintext highlighter-rouge">NA</code>s) are coloured <code class="language-plaintext highlighter-rouge">grey90</code>. The year of the introduction of vaccination is indicated as a dark vertical stripe. If the y-axis labels are too many or too small, they can be dropped the same way as the x-axis. A custom colour palette was used from <a href="http://colorbrewer.org/">ColorBrewer</a> based on the Spectral palette. Using the R package <code class="language-plaintext highlighter-rouge">RColorBrewer()</code> or using ggplot2 function <code class="language-plaintext highlighter-rouge">scale_fill_brewer()</code> opens up all the colour palettes from the ColorBrewer website. Here is an example below:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span><span class="w">

</span><span class="c1">#change the scale_fill_manual from previous code to below</span><span class="w">
</span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">rev</span><span class="p">(</span><span class="n">brewer.pal</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="s2">"YlGnBu"</span><span class="p">)),</span><span class="w"> </span><span class="n">na.value</span><span class="o">=</span><span class="s2">"grey90"</span><span class="p">)</span><span class="o">+</span><span class="w">            
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972149220"><a href="/assets/images/posts/2019/2019-02-17-a-guide-to-elegant-tiled-heatmaps-in-r-2019/measles-mod3.png" title="Heatmap with Colorbrewer colour palette.">
      <img src="/assets/images/posts/2019/2019-02-17-a-guide-to-elegant-tiled-heatmaps-in-r-2019/measles-mod3.png" alt="mod3" />
    </a>
    <figcaption>
    Heatmap with Colorbrewer colour palette.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972149220 a'});
</script>

<p>Most of the plot customisation happens in the <code class="language-plaintext highlighter-rouge">theme()</code> section of the code. Refer to the <a href="http://docs.ggplot2.org/current/theme.html">ggplot index</a> for all theme arguments. Based on where the figure will go next, the fonts may need to be changed. The <code class="language-plaintext highlighter-rouge">extrafont()</code> package comes handy. Another option is to export in vector format such as .svg or .pdf. Import into a vector editor such as Adobe Illustrator and add your own text. This will produce nice crisp results but does take some manual work. See the cover image of this post for example.</p>

<h3 id="22-base-graphics">2.2 Base graphics</h3>

<p>We will take a quick look at plotting using base graphics. The base function <code class="language-plaintext highlighter-rouge">heatmap()</code> and the enchanced <code class="language-plaintext highlighter-rouge">heatmap.2()</code> function from the <code class="language-plaintext highlighter-rouge">gplots</code> package uses a wide format data matrix as input. We start with the ‘long’ data that we prepared in section 1. We convert the data in ‘long’ format into ‘wide’ format using the <code class="language-plaintext highlighter-rouge">spread()</code> function from package <strong>tidyr</strong>. The wide data is converted to a matrix after removal of non-numeric columns. The state names are reassigned as rownames of the matrix to be used as y-axis text.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load package</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gplots</span><span class="p">)</span><span class="w"> </span><span class="c1"># heatmap.2() function</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plotrix</span><span class="p">)</span><span class="w"> </span><span class="c1"># gradient.rect() function</span><span class="w">

</span><span class="c1"># convert from long format to wide format</span><span class="w">
</span><span class="n">m5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">m3</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">spread</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">"state"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="n">count</span><span class="p">)</span><span class="w">
</span><span class="n">m6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">m5</span><span class="p">[</span><span class="w"> </span><span class="p">,</span><span class="m">-1</span><span class="p">])</span><span class="w">
</span><span class="n">rownames</span><span class="p">(</span><span class="n">m6</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">m5</span><span class="o">$</span><span class="n">year</span><span class="w">

</span><span class="c1">#base heatmap</span><span class="w">
</span><span class="n">png</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">"measles-base.png"</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">5.5</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">8.8</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="o">=</span><span class="m">200</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="o">=</span><span class="s2">"in"</span><span class="p">)</span><span class="w">
</span><span class="n">heatmap</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">m6</span><span class="p">),</span><span class="w"> </span><span class="n">Rowv</span><span class="o">=</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">Colv</span><span class="o">=</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="o">=</span><span class="s2">"none"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">terrain.colors</span><span class="p">(</span><span class="m">100</span><span class="p">),</span><span class="w">
  </span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s2">"Incidence of Measles in the US"</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972184746"><a href="/assets/images/posts/2019/2019-02-17-a-guide-to-elegant-tiled-heatmaps-in-r-2019/measles-base.png" title="Heatmap using the base function `heatmap()`.">
      <img src="/assets/images/posts/2019/2019-02-17-a-guide-to-elegant-tiled-heatmaps-in-r-2019/measles-base.png" alt="measles-base" />
    </a>
    <figcaption>
    Heatmap using the base function <code class="language-plaintext highlighter-rouge">heatmap()</code>.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972184746 a'});
</script>

<p>That’s pretty much what we can do with that. The enchanced <code class="language-plaintext highlighter-rouge">heatmap.2()</code> function from <strong>gplots</strong> package can do more. The legend for the colours is not the best, so we will use the function <code class="language-plaintext highlighter-rouge">gradient.rect()</code> from <strong>plotrix</strong> package to create our own legend. And after fiddling around with numerous arguments and countless trial and errors later, we have as below.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># gplots heatmap.2</span><span class="w">
</span><span class="n">png</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">"measles-gplot.png"</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="o">=</span><span class="m">200</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="o">=</span><span class="s2">"in"</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">gplots</span><span class="o">::</span><span class="n">heatmap.2</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">m6</span><span class="p">),</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">dendrogram</span><span class="o">=</span><span class="s2">"none"</span><span class="p">,</span><span class="w"> </span><span class="n">Rowv</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">Colv</span><span class="o">=</span><span class="s2">"Rowv"</span><span class="p">,</span><span class="w"> </span><span class="n">trace</span><span class="o">=</span><span class="s2">"none"</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="o">=</span><span class="s2">"none"</span><span class="p">,</span><span class="w"> </span><span class="n">offsetRow</span><span class="o">=</span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="n">offsetCol</span><span class="o">=</span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">m4</span><span class="o">$</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)),</span><span class="w"> </span><span class="n">colsep</span><span class="o">=</span><span class="n">which</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">1928</span><span class="p">,</span><span class="w"> </span><span class="m">2003</span><span class="p">)</span><span class="o">%%</span><span class="m">10</span><span class="o">==</span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">margin</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">rev</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#d53e4f"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#f46d43"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fdae61"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fee08b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#e6f598"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#abdda4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#ddf1da"</span><span class="p">)),</span><span class="w"> 
</span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="o">=</span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">lhei</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">),</span><span class="w"> </span><span class="n">lwid</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="m">0.8</span><span class="p">))</span><span class="w">
</span><span class="n">gradient.rect</span><span class="p">(</span><span class="m">0.125</span><span class="p">,</span><span class="w"> </span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="m">0.135</span><span class="p">,</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w"> </span><span class="n">nslices</span><span class="o">=</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">border</span><span class="o">=</span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">gradient</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">rev</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#d53e4f"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#f46d43"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fdae61"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fee08b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#e6f598"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#abdda4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#ddf1da"</span><span class="p">)))</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="m">0.118</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">0.28</span><span class="p">,</span><span class="w"> </span><span class="m">0.72</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="m">0.07</span><span class="p">),</span><span class="w"> </span><span class="n">adj</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0-1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1-10"</span><span class="p">,</span><span class="w"> </span><span class="s2">"10-100"</span><span class="p">,</span><span class="w"> </span><span class="s2">"100-500"</span><span class="p">,</span><span class="w"> </span><span class="s2">"500-1000"</span><span class="p">,</span><span class="w"> </span><span class="s2">"&gt;1000"</span><span class="p">))</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="m">0.135</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="m">0.82</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="s2">"Cases per\n100,000 people"</span><span class="p">,</span><span class="w"> </span><span class="n">adj</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">0.85</span><span class="p">)</span><span class="w">
</span><span class="n">title</span><span class="p">(</span><span class="n">main</span><span class="o">=</span><span class="s2">"Incidence of Measles in the US"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">oma</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">adj</span><span class="o">=</span><span class="m">0.21</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972181708"><a href="/assets/images/posts/2019/2019-02-17-a-guide-to-elegant-tiled-heatmaps-in-r-2019/measles-gplot.png" title="Heatmap created using gplots function `heatmap.2()`.">
      <img src="/assets/images/posts/2019/2019-02-17-a-guide-to-elegant-tiled-heatmaps-in-r-2019/measles-gplot.png" alt="measles-gplot" />
    </a>
    <figcaption>
    Heatmap created using gplots function <code class="language-plaintext highlighter-rouge">heatmap.2()</code>.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972181708 a'});
</script>

<p>Ultimately, we get something useful. The white separator line is a neat feature. It can be used to group columns or rows as required. The while vertical lines above group decades. And below is the full undisrupted code.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 2019 | Roy Mathew Francis</span><span class="w">
</span><span class="c1"># Heatmap R code</span><span class="w">

</span><span class="c1">#load packages</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w"> </span><span class="c1"># ggplot() for plotting</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w"> </span><span class="c1"># data reformatting</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w"> </span><span class="c1"># data reformatting</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w"> </span><span class="c1"># string manipulation</span><span class="w">

</span><span class="c1"># DATA PREPARATION -------------------------------------------------------------</span><span class="w">

</span><span class="c1">#read csv file</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"measles_lev1.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">skip</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">

</span><span class="n">m2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># convert data to long format</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">"state"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="s2">"value"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">YEAR</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">WEEK</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># rename columns</span><span class="w">
  </span><span class="n">setNames</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"year"</span><span class="p">,</span><span class="w"> </span><span class="s2">"week"</span><span class="p">,</span><span class="w"> </span><span class="s2">"state"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># convert year to factor</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">year</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># convert week to factor</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">week</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">week</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># convert value to numeric (also converts '-' to NA, gives a warning)</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w">

</span><span class="c1"># removes . and change states to title case using custom function</span><span class="w">
</span><span class="n">fn_tc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">str_to_title</span><span class="p">(</span><span class="n">unlist</span><span class="p">(</span><span class="n">strsplit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s2">"[.]"</span><span class="p">))),</span><span class="w"> </span><span class="n">collapse</span><span class="o">=</span><span class="s2">" "</span><span class="p">)</span><span class="w">
</span><span class="n">m2</span><span class="o">$</span><span class="n">state</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">m2</span><span class="o">$</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">fn_tc</span><span class="p">)</span><span class="w">

</span><span class="c1"># custom sum function returns NA when all values in set are NA,</span><span class="w">
</span><span class="c1"># in a set mixed with NAs, NAs are removed and remaining summed.</span><span class="w">
</span><span class="n">na_sum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="nf">all</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">all</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># sum incidences for all weeks into one year</span><span class="w">
</span><span class="n">m3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">na_sum</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">as.data.frame</span><span class="p">()</span><span class="w">

</span><span class="n">m4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">m3</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># convert state to factor and reverse order of levels</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="n">rev</span><span class="p">(</span><span class="n">sort</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">state</span><span class="p">)))))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># create a new variable from count</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">countfactor</span><span class="o">=</span><span class="n">cut</span><span class="p">(</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)),</span><span class="w">
                          </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0-1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1-10"</span><span class="p">,</span><span class="w"> </span><span class="s2">"10-100"</span><span class="p">,</span><span class="w"> </span><span class="s2">"100-500"</span><span class="p">,</span><span class="w"> </span><span class="s2">"500-1000"</span><span class="p">,</span><span class="w"> </span><span class="s2">"&gt;1000"</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="c1"># change level order</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">countfactor</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">countfactor</span><span class="p">),</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="n">rev</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">countfactor</span><span class="p">))))</span><span class="w">

</span><span class="c1"># GGPLOT -----------------------------------------------------------------------</span><span class="w">

</span><span class="c1"># assign text colour</span><span class="w">
</span><span class="n">textcol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"grey40"</span><span class="w">

</span><span class="c1"># further modified ggplot</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">m4</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">countfactor</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_tile</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">0.2</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">guide_legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Cases per\n100,000 people"</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s2">"Incidence of Measles in the US"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_discrete</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"1930"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1940"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1950"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1960"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1970"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1980"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1990"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2000"</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#d53e4f"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#f46d43"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fdae61"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fee08b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#e6f598"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#abdda4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#ddf1da"</span><span class="p">),</span><span class="w"> </span><span class="n">na.value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey90"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="c1">#coord_fixed()+</span><span class="w">
  </span><span class="n">theme_grey</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"right"</span><span class="p">,</span><span class="w"> </span><span class="n">legend.direction</span><span class="o">=</span><span class="s2">"vertical"</span><span class="p">,</span><span class="w">
        </span><span class="n">legend.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="n">textcol</span><span class="p">),</span><span class="w">
        </span><span class="n">legend.margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">grid</span><span class="o">::</span><span class="n">unit</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">)),</span><span class="w">
        </span><span class="n">legend.text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="n">textcol</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">),</span><span class="w">
        </span><span class="n">legend.key.height</span><span class="o">=</span><span class="n">grid</span><span class="o">::</span><span class="n">unit</span><span class="p">(</span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">),</span><span class="w">
        </span><span class="n">legend.key.width</span><span class="o">=</span><span class="n">grid</span><span class="o">::</span><span class="n">unit</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.text.x</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">textcol</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.text.y</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">vjust</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">textcol</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.ticks</span><span class="o">=</span><span class="n">element_line</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">0.4</span><span class="p">),</span><span class="w">
        </span><span class="n">plot.background</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">panel.border</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">plot.margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="m">0.7</span><span class="p">,</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">),</span><span class="w">
        </span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="n">textcol</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span><span class="w">
      </span><span class="p">)</span><span class="w">

</span><span class="c1"># export figure</span><span class="w">
</span><span class="n">ggsave</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="s2">"measles-mod3.png"</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">5.5</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">8.8</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="o">=</span><span class="s2">"in"</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="o">=</span><span class="m">200</span><span class="p">)</span><span class="w">

</span><span class="c1"># BASE GRAPHICS ----------------------------------------------------------------</span><span class="w">

</span><span class="c1"># load package</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gplots</span><span class="p">)</span><span class="w"> </span><span class="c1"># heatmap.2() function</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">plotrix</span><span class="p">)</span><span class="w"> </span><span class="c1"># gradient.rect() function</span><span class="w">

</span><span class="c1"># convert from long format to wide format</span><span class="w">
</span><span class="n">m5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">m3</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">spread</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">"state"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="n">count</span><span class="p">)</span><span class="w">
</span><span class="n">m6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">m5</span><span class="p">[</span><span class="w"> </span><span class="p">,</span><span class="m">-1</span><span class="p">])</span><span class="w">
</span><span class="n">rownames</span><span class="p">(</span><span class="n">m6</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">m5</span><span class="o">$</span><span class="n">year</span><span class="w">

</span><span class="c1"># base heatmap</span><span class="w">
</span><span class="n">png</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">"measles-base.png"</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">5.5</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">8.8</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="o">=</span><span class="m">200</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="o">=</span><span class="s2">"in"</span><span class="p">)</span><span class="w">
</span><span class="n">heatmap</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">m6</span><span class="p">),</span><span class="w"> </span><span class="n">Rowv</span><span class="o">=</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">Colv</span><span class="o">=</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="o">=</span><span class="s2">"none"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">terrain.colors</span><span class="p">(</span><span class="m">100</span><span class="p">),</span><span class="w">
        </span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s2">"Incidence of Measles in the US"</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">

</span><span class="c1"># gplots heatmap.2</span><span class="w">
</span><span class="n">png</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">"measles-gplot.png"</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="o">=</span><span class="m">200</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="o">=</span><span class="s2">"in"</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">gplots</span><span class="o">::</span><span class="n">heatmap.2</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">m6</span><span class="p">),</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">dendrogram</span><span class="o">=</span><span class="s2">"none"</span><span class="p">,</span><span class="w"> </span><span class="n">Rowv</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">Colv</span><span class="o">=</span><span class="s2">"Rowv"</span><span class="p">,</span><span class="w"> </span><span class="n">trace</span><span class="o">=</span><span class="s2">"none"</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="o">=</span><span class="s2">"none"</span><span class="p">,</span><span class="n">offsetRow</span><span class="o">=</span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="n">offsetCol</span><span class="o">=</span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">m4</span><span class="o">$</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)),</span><span class="w"> </span><span class="n">colsep</span><span class="o">=</span><span class="n">which</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">1928</span><span class="p">,</span><span class="w"> </span><span class="m">2003</span><span class="p">)</span><span class="o">%%</span><span class="m">10</span><span class="o">==</span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">margin</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">rev</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#d53e4f"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#f46d43"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fdae61"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fee08b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#e6f598"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#abdda4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#ddf1da"</span><span class="p">)),</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="o">=</span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">lhei</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">),</span><span class="w"> </span><span class="n">lwid</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="m">0.8</span><span class="p">))</span><span class="w">
</span><span class="n">gradient.rect</span><span class="p">(</span><span class="m">0.125</span><span class="p">,</span><span class="w"> </span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="m">0.135</span><span class="p">,</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w"> </span><span class="n">nslices</span><span class="o">=</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">border</span><span class="o">=</span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">gradient</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">rev</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#d53e4f"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#f46d43"</span><span class="p">,</span><span class="s2">"#fdae61"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fee08b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#e6f598"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#abdda4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#ddf1da"</span><span class="p">)))</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="m">0.118</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">0.28</span><span class="p">,</span><span class="w"> </span><span class="m">0.72</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="m">0.07</span><span class="p">),</span><span class="w"> </span><span class="n">adj</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0-1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1-10"</span><span class="p">,</span><span class="w"> </span><span class="s2">"10-100"</span><span class="p">,</span><span class="w"> </span><span class="s2">"100-500"</span><span class="p">,</span><span class="w"> </span><span class="s2">"500-1000"</span><span class="p">,</span><span class="w"> </span><span class="s2">"&gt;1000"</span><span class="p">))</span><span class="w">
</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="m">0.135</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="m">0.82</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="s2">"Cases per\n100,000 people"</span><span class="p">,</span><span class="w"> </span><span class="n">adj</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">0.85</span><span class="p">)</span><span class="w">
</span><span class="n">title</span><span class="p">(</span><span class="n">main</span><span class="o">=</span><span class="s2">"Incidence of Measles in the US"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">oma</span><span class="o">=</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">adj</span><span class="o">=</span><span class="m">0.21</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">

</span><span class="c1"># End of script ----------------------------------------------------------------</span><span class="w">
</span></code></pre></div></div>
<h2 id="3-conclusion">3. Conclusion</h2>

<p>We have covered data prep and plotting heatmaps in R using base graphics and ggplot2. <code class="language-plaintext highlighter-rouge">ggplot2</code> seems more consistent with code structure but the base graphics may be useful when combing multiple graphics in complicated ways. Hacking <code class="language-plaintext highlighter-rouge">ggplot2</code> can be harder than fiddling with base graphics. I have not covered heatmaps with dendrograms because they are only useful in specific situations. Perhaps another useful function for heatmaps in R is <a href="https://github.com/raivokolde/pheatmap">pheatmap</a> demonstrated <a href="https://davetang.org/muse/2018/05/15/making-a-heatmap-in-r-with-the-pheatmap-package/">here</a>.</p>]]></content><author><name>Roy Francis</name></author><category term="[&quot;Code&quot;, &quot;Research&quot;]" /><category term="Data Analysis" /><category term="Data Visualisation" /><category term="ggplot2" /><category term="Heatmap" /><category term="R" /><summary type="html"><![CDATA[A step-by-step guide to data preparation and plotting of simple, neat and elegant heatmaps in R using base graphics and ggplot2.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://royfrancis.com/assets/images/posts/2019/2019-02-17-a-guide-to-elegant-tiled-heatmaps-in-r-2019/featured.png" /><media:content medium="image" url="https://royfrancis.com/assets/images/posts/2019/2019-02-17-a-guide-to-elegant-tiled-heatmaps-in-r-2019/featured.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Beautiful circos plots in R</title><link href="https://royfrancis.com/beautiful-circos-plots-in-r/" rel="alternate" type="text/html" title="Beautiful circos plots in R" /><published>2019-02-17T16:15:23+01:00</published><updated>2019-02-17T16:15:23+01:00</updated><id>https://royfrancis.com/beautiful-circos-plots-in-r</id><content type="html" xml:base="https://royfrancis.com/beautiful-circos-plots-in-r/"><![CDATA[<p><a href="http://circos.ca/">Circos</a> plots are popular for displaying huge amounts of data in a relatively small visual space. This is especially relevant for genomic data. This post explores creating Circos-style genomic data plots in R using R package <a href="https://github.com/jokergoo/circlize">circlize</a>.</p>

<p>The first step is plan your figure. How many genomes to include? Or perhaps, it’s one genome with multiple chromosomes. What sort of information do you want to include? In my case, I have three bacterial genomes for which I would like to show the sequencing depth, GC content, locations of important genes and finally rearrangements between the three genomes. You need to have all this data prepared first. Unfortunately I am unable to provide the raw files, but I can give an idea of the file formats.</p>

<h2 id="data">Data</h2>

<p>My three genomes are named pb_501_001, pb_501_002 and pb_501_003.</p>

<p>Coverage was computed on BAM files using <code class="language-plaintext highlighter-rouge">bedtools genomecov</code>. The data looked like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pb_501_001 1 24
pb_501_001 2 58
pb_501_001 3 62
...
</code></pre></div></div>

<p>with columns: sample, base and depth. This was read into R and converted to median coverage within a window size of 1000 bases creating a BED format. This is file named <strong>cov</strong> later in the code.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chr        start end  value1
pb_501_001 1     1000 145
pb_501_001 1001  2000 154
pb_501_001 2001  3000 158
...
</code></pre></div></div>

<p>The GC content was computed using <code class="language-plaintext highlighter-rouge">bedtools nuc</code>. The data is a typical BED format when read into R looks like below. This is the file named <strong>gc</strong> later in the code.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chr        start end  value1
pb_501_001 1     1000 145.0
pb_501_001 1001  2000 154.0
pb_501_001 2001  3000 158.0
...
</code></pre></div></div>

<p>The gene annotation file looks like below. This file is called <strong>ann</strong> later in the code.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chr        start  end    value1 gene
pb_501_001 325210 326376 1      yxeP
pb_501_001 397301 397795 1      sorB
pb_501_001 399088 400035 1      sorC
...
</code></pre></div></div>

<p>The value1 is a random value (to maintain bed format, the actual value is not used).</p>

<p>The rearrangements can be obtained from <a href="http://darlinglab.org/mauve/mauve.html">Mauve</a> or Nucmer (<a href="http://mummer.sourceforge.net/">Mummer</a>). The data is for pairs of genomes/chromosomes and it looks like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pb_501_001 1     59986   pb_501_002 1       62503
pb_501_001 60196 1183032 pb_501_002 4682296 3560259
...
</code></pre></div></div>

<p>with columns: name of genome/chr 1, start position in 1, end position in 1, name of genome/chr 2, start position in 2, end position in 2.</p>

<p>This is split up into two files which I call <strong>nuc1</strong> and <strong>nuc2</strong> later in the code.</p>

<p><strong>nuc1</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pb_501_001 1       59986
pb_501_001 60196   1183032
pb_501_001 1182899 4708778
...
</code></pre></div></div>

<p><strong>nuc2</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pb_501_002 1       62503
pb_501_002 4682296 3560259
pb_501_002 67566   3555254
...
</code></pre></div></div>

<h2 id="plotting">Plotting</h2>

<p>We are now ready to start plotting. We will first look at the default code for each step and then also explore the customised code . Plots are showed side by side to compare default and customised results.</p>

<p>Start by loading the library and initialising the layout.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">circlize</span><span class="p">)</span><span class="w">
</span><span class="n">circos.clear</span><span class="p">()</span><span class="w">
</span><span class="n">circos.initialize</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"pb_501_001"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pb_501_002"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pb_501_003"</span><span class="p">),</span><span class="w"> 
</span><span class="n">xlim</span><span class="o">=</span><span class="n">matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">ref</span><span class="o">$</span><span class="n">V2</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">xlim</code> matrix defines the start and stop for each genome/chr. Essentially the genome or chr sizes. The matrix looks like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">ref</span><span class="o">$</span><span class="n">V2</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
        </span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="m">1</span><span class="p">,]</span><span class="w"> </span><span class="m">0</span><span class="w">    </span><span class="m">5167156</span><span class="w">
</span><span class="p">[</span><span class="m">2</span><span class="p">,]</span><span class="w"> </span><span class="m">0</span><span class="w">    </span><span class="m">5138029</span><span class="w">
</span><span class="p">[</span><span class="m">3</span><span class="p">,]</span><span class="w"> </span><span class="m">0</span><span class="w">    </span><span class="m">5080212</span><span class="w">
</span></code></pre></div></div>

<h3 id="genome">Genome</h3>

<p>At this point, the plotting window is still blank because nothing as actually been drawn. Then we create the genome backbone.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># genomes</span><span class="w">
</span><span class="n">circos.track</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">panel.fun</span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">chr</span><span class="o">=</span><span class="n">CELL_META</span><span class="o">$</span><span class="n">sector.index</span><span class="w">
</span><span class="n">xlim</span><span class="o">=</span><span class="n">CELL_META</span><span class="o">$</span><span class="n">xlim</span><span class="w">
</span><span class="n">ylim</span><span class="o">=</span><span class="n">CELL_META</span><span class="o">$</span><span class="n">ylim</span><span class="w">
</span><span class="n">circos.text</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">xlim</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">ylim</span><span class="p">),</span><span class="w"> </span><span class="n">chr</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<p>Now, we can see the plot showing the three genomes and their relative lengths. They are labelled using the <code class="language-plaintext highlighter-rouge">circos.text()</code> command. We can customise this by first setting some custom defaults using <code class="language-plaintext highlighter-rouge">circos.par()</code>. <code class="language-plaintext highlighter-rouge">gap.degree</code> is increased to increase gap width so as to fit in our y-axis labels later. <code class="language-plaintext highlighter-rouge">cell.padding</code> is set to zero to reduce empty space around the plots. Then, we resize the panel height, adjust text size and background colour.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">circos.clear</span><span class="p">()</span><span class="w">
</span><span class="n">col_text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"grey40"</span><span class="w">
</span><span class="n">circos.par</span><span class="p">(</span><span class="s2">"track.height"</span><span class="o">=</span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="n">gap.degree</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">cell.padding</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">
</span><span class="n">circos.initialize</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="n">ref</span><span class="o">$</span><span class="n">V1</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="n">matrix</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">ref</span><span class="o">$</span><span class="n">V2</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">))</span><span class="w">

</span><span class="c1"># genomes</span><span class="w">
</span><span class="n">circos.track</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">panel.fun</span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">chr</span><span class="o">=</span><span class="n">CELL_META</span><span class="o">$</span><span class="n">sector.index</span><span class="w">
</span><span class="n">xlim</span><span class="o">=</span><span class="n">CELL_META</span><span class="o">$</span><span class="n">xlim</span><span class="w">
</span><span class="n">ylim</span><span class="o">=</span><span class="n">CELL_META</span><span class="o">$</span><span class="n">ylim</span><span class="w">
</span><span class="n">circos.text</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">xlim</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">ylim</span><span class="p">),</span><span class="w"> </span><span class="n">chr</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">col_text</span><span class="p">,</span><span class="w"> 
</span><span class="n">facing</span><span class="o">=</span><span class="s2">"bending.inside"</span><span class="p">,</span><span class="w"> </span><span class="n">niceFacing</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="p">},</span><span class="w"> </span><span class="n">bg.col</span><span class="o">=</span><span class="s2">"grey90"</span><span class="p">,</span><span class="w"> </span><span class="n">bg.border</span><span class="o">=</span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">track.height</span><span class="o">=</span><span class="m">0.06</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now we can compare how our raw and custom plots look like.</p>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972194790"><a href="/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/circos-backbone.jpg" title="Genome backbone seen using default setting (left) and customised settings (right).">
      <img src="/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/circos-backbone.jpg" alt="circos-backbone" />
    </a>
    <figcaption>
    Genome backbone seen using default setting (left) and customised settings (right).

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972194790 a'});
</script>

<p>Let’s add an x-axis to the plot:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># genomes x axis</span><span class="w">
</span><span class="n">circos.track</span><span class="p">(</span><span class="n">track.index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get.current.track.index</span><span class="p">(),</span><span class="w"> </span><span class="n">panel.fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">circos.axis</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="s2">"top"</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<p>We can see the x-axis added (see below). We are going to add custom breaks, change label colour, size, direction and thickness of the axis line.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># genomes x axis</span><span class="w">
</span><span class="n">brk</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2.5</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">3.5</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4.5</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="o">*</span><span class="m">10</span><span class="o">^</span><span class="m">6</span><span class="w">
</span><span class="n">circos.track</span><span class="p">(</span><span class="n">track.index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get.current.track.index</span><span class="p">(),</span><span class="w"> </span><span class="n">panel.fun</span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">circos.axis</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="s2">"top"</span><span class="p">,</span><span class="w"> </span><span class="n">major.at</span><span class="o">=</span><span class="n">brk</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="nf">round</span><span class="p">(</span><span class="n">brk</span><span class="o">/</span><span class="m">10</span><span class="o">^</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">labels.cex</span><span class="o">=</span><span class="m">0.4</span><span class="p">,</span><span class="w"> 
</span><span class="n">col</span><span class="o">=</span><span class="n">col_text</span><span class="p">,</span><span class="w"> </span><span class="n">labels.col</span><span class="o">=</span><span class="n">col_text</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="w"> </span><span class="n">labels.facing</span><span class="o">=</span><span class="s2">"clockwise"</span><span class="p">)</span><span class="w">
</span><span class="p">},</span><span class="w"> </span><span class="n">bg.border</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-2022011423360333036297274851"><a href="/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/circos-xaxis.jpg" title="Genome backbone with x-axis seen using default setting (left) and customised settings (right).">
      <img src="/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/circos-xaxis.jpg" alt="circos-xaxis" />
    </a>
    <figcaption>
    Genome backbone with x-axis seen using default setting (left) and customised settings (right).

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297274851 a'});
</script>

<h3 id="coverage">Coverage</h3>

<p>Let’s add the coverage information and a y-axis for the coverage:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># coverage</span><span class="w">
</span><span class="n">circos.genomicTrack</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cov</span><span class="p">,</span><span class="w"> </span><span class="n">panel.fun</span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">circos.genomicLines</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span><span class="c1"># coverage y axis</span><span class="w">
</span><span class="n">circos.yaxis</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p>The coverage along the genome is displayed as a line. The y-axis is used to show a reference for the values that are plotted. We will change properties of the line such as colour and thickness. We add extra segments to act as gridlines. And we remove all y-axis elements except the text.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># coverage</span><span class="w">
</span><span class="n">circos.genomicTrack</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cov</span><span class="p">,</span><span class="w"> </span><span class="n">panel.fun</span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">circos.genomicLines</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"l"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"grey50"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">0.6</span><span class="p">)</span><span class="w">
</span><span class="n">circos.segments</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">ref</span><span class="o">$</span><span class="n">V2</span><span class="p">),</span><span class="w"> </span><span class="n">y0</span><span class="o">=</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="o">=</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="s2">"11"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"grey90"</span><span class="p">)</span><span class="w">
</span><span class="n">circos.segments</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">ref</span><span class="o">$</span><span class="n">V2</span><span class="p">),</span><span class="w"> </span><span class="n">y0</span><span class="o">=</span><span class="m">300</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="o">=</span><span class="m">300</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="s2">"11"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"grey90"</span><span class="p">)</span><span class="w">
</span><span class="c1">#circos.segments(x0=0, x1=max(ref$V2), y0=500, y1=500, lwd=0.6, lty="11", col="grey90")</span><span class="w">
</span><span class="p">},</span><span class="w"> </span><span class="n">track.height</span><span class="o">=</span><span class="m">0.08</span><span class="p">,</span><span class="w"> </span><span class="n">bg.border</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="n">circos.yaxis</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">300</span><span class="p">),</span><span class="w"> </span><span class="n">labels.cex</span><span class="o">=</span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">tick.length</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">labels.col</span><span class="o">=</span><span class="n">col_text</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"#FFFFFF"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972166102"><a href="/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/circos-coverage.jpg" title="Circlize plot showing coverage using default setting (left) and customised settings (right).">
      <img src="/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/circos-coverage.jpg" alt="circos-coverage" />
    </a>
    <figcaption>
    Circlize plot showing coverage using default setting (left) and customised settings (right).

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972166102 a'});
</script>

<h3 id="gc-content">GC content</h3>

<p>Let’s add GC content and it’s y-axis:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># gc content</span><span class="w">
</span><span class="n">circos.track</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="n">gc</span><span class="o">$</span><span class="n">chr</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="n">gc</span><span class="o">$</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gc</span><span class="o">$</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">panel.fun</span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">circos.lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span><span class="c1"># gc y axis</span><span class="w">
</span><span class="n">circos.yaxis</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p>Similar to the previous step, GC content is displayed as lines. The customisation is similar to the previous step. The gridline positions and values have obviously changed.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># gc content</span><span class="w">
</span><span class="n">circos.track</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="n">gc</span><span class="o">$</span><span class="n">chr</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="n">gc</span><span class="o">$</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gc</span><span class="o">$</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">panel.fun</span><span class="o">=</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">circos.lines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"grey50"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">0.6</span><span class="p">)</span><span class="w">
</span><span class="n">circos.segments</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">ref</span><span class="o">$</span><span class="n">V2</span><span class="p">),</span><span class="w"> </span><span class="n">y0</span><span class="o">=</span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="o">=</span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="s2">"11"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"grey90"</span><span class="p">)</span><span class="w">
</span><span class="n">circos.segments</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">ref</span><span class="o">$</span><span class="n">V2</span><span class="p">),</span><span class="w"> </span><span class="n">y0</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="s2">"11"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"grey90"</span><span class="p">)</span><span class="w">
</span><span class="n">circos.segments</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="o">=</span><span class="nf">max</span><span class="p">(</span><span class="n">ref</span><span class="o">$</span><span class="n">V2</span><span class="p">),</span><span class="w"> </span><span class="n">y0</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="o">=</span><span class="m">0.7</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">0.6</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="s2">"11"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"grey90"</span><span class="p">)</span><span class="w">
</span><span class="p">},</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">range</span><span class="p">(</span><span class="n">gc</span><span class="o">$</span><span class="n">value</span><span class="p">),</span><span class="w"> </span><span class="n">track.height</span><span class="o">=</span><span class="m">0.08</span><span class="p">,</span><span class="w"> </span><span class="n">bg.border</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="c1"># gc y axis</span><span class="w">
</span><span class="n">circos.yaxis</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.7</span><span class="p">),</span><span class="w"> </span><span class="n">labels.cex</span><span class="o">=</span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">tick.length</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">labels.col</span><span class="o">=</span><span class="n">col_text</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"#FFFFFF"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-2022011423360333036297249063"><a href="/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/circos-gc.jpg" title="Circlize plot showing GC content graph using default setting (left) and customised settings (right).">
      <img src="/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/circos-gc.jpg" alt="circos-gc" />
    </a>
    <figcaption>
    Circlize plot showing GC content graph using default setting (left) and customised settings (right).

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297249063 a'});
</script>

<h3 id="gene-labels">Gene labels</h3>

<p>Then we add gene labels:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># gene labels</span><span class="w">
</span><span class="n">circos.genomicLabels</span><span class="p">(</span><span class="n">ann</span><span class="p">,</span><span class="w"> </span><span class="n">labels.column</span><span class="o">=</span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The gene labels are added along with connection lines to indicate their exact position in the genome. This is too crowded without some manual customisation. We adjust the label size, colour and the length, thickness and colour of the connection lines. The track height is set to a custom value.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># gene labels</span><span class="w">
</span><span class="n">circos.genomicLabels</span><span class="p">(</span><span class="n">ann</span><span class="p">,</span><span class="w"> </span><span class="n">labels.column</span><span class="o">=</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">col_text</span><span class="p">,</span><span class="w"> </span><span class="n">line_lwd</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">line_col</span><span class="o">=</span><span class="s2">"grey80"</span><span class="p">,</span><span class="w"> 
</span><span class="n">side</span><span class="o">=</span><span class="s2">"inside"</span><span class="p">,</span><span class="w"> </span><span class="n">connection_height</span><span class="o">=</span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="n">labels_height</span><span class="o">=</span><span class="m">0.04</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972164515"><a href="/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/circos-genes.jpg" title="Circlize plot showing gene positions and gene labels using default setting (left) and customised settings (right).">
      <img src="/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/circos-genes.jpg" alt="circos-genes" />
    </a>
    <figcaption>
    Circlize plot showing gene positions and gene labels using default setting (left) and customised settings (right).

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972164515 a'});
</script>

<h3 id="rearrangements">Rearrangements</h3>

<p>Finally, we add the rearrangements using <code class="language-plaintext highlighter-rouge">circos.genomicLink()</code> function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># rearrangements</span><span class="w">
</span><span class="n">circos.genomicLink</span><span class="p">(</span><span class="n">nuc1</span><span class="p">,</span><span class="w"> </span><span class="n">nuc2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>If you are running these steps interactively, this may not be visible as there is no space. But, if you run this inside a <code class="language-plaintext highlighter-rouge">png()</code> device, you can at least see it. Since there is no transparency, overlapping ribbons are not visible. We will assign green colour to rearrangements in the same direction and red colour to inversions. And we set 0.4 opacity for better visibility of overlapping ribbons.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># rearrangements</span><span class="w">
</span><span class="n">rcols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">scales</span><span class="o">::</span><span class="n">alpha</span><span class="p">(</span><span class="n">ifelse</span><span class="p">(</span><span class="nf">sign</span><span class="p">(</span><span class="n">nuc1</span><span class="o">$</span><span class="n">start</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">nuc1</span><span class="o">$</span><span class="n">end</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nf">sign</span><span class="p">(</span><span class="n">nuc2</span><span class="o">$</span><span class="n">start</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">nuc2</span><span class="o">$</span><span class="n">end</span><span class="p">),</span><span class="w"> </span><span class="s2">"#f46d43"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#66c2a5"</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.4</span><span class="p">)</span><span class="w">
</span><span class="n">circos.genomicLink</span><span class="p">(</span><span class="n">nuc1</span><span class="p">,</span><span class="w"> </span><span class="n">nuc2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">rcols</span><span class="p">,</span><span class="w"> </span><span class="n">border</span><span class="o">=</span><span class="kc">NA</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>And here we have the complete plot. Track heights for every track has been reduced to leave space for the rearrangement link figure in the middle.</p>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-2022011423360333036297239276"><a href="/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/circos-full.jpg" title="Circlize plot using default setting (left) and customised settings (right).">
      <img src="/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/circos-full.jpg" alt="circos-full" />
    </a>
    <figcaption>
    Circlize plot using default setting (left) and customised settings (right).

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297239276 a'});
</script>

<p>For the purpose of captioning, I have further added some numbers in an image editing software. This will be useful to describe each part of the figure.</p>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972139628"><a href="/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/circos.jpg" title="Circos plot with custom labels added for captions.">
      <img src="/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/circos.jpg" alt="featured" />
    </a>
    <figcaption>
    Circos plot with custom labels added for captions.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972139628 a'});
</script>]]></content><author><name>Roy Francis</name></author><category term="[&quot;Code&quot;, &quot;Research&quot;]" /><category term="Data Visualisation" /><category term="Genomics" /><category term="NGS" /><category term="R" /><summary type="html"><![CDATA[Circos plots are popular for displaying huge amounts of data in a relatively small visual space. This is especially relevant for genomic data. This post explores creating Circos-style genomic data plots in R using R package circlize.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://royfrancis.com/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/featured.jpg" /><media:content medium="image" url="https://royfrancis.com/assets/images/posts/2019/2019-02-17-beautiful-circos-plots-in-r/featured.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Fast LD computation from VCF files using Tomahawk</title><link href="https://royfrancis.com/fast-ld-computation-from-vcf-files-using-tomahawk/" rel="alternate" type="text/html" title="Fast LD computation from VCF files using Tomahawk" /><published>2018-12-01T13:45:07+01:00</published><updated>2018-12-01T13:45:07+01:00</updated><id>https://royfrancis.com/fast-ld-computation-from-vcf-files-using-tomahawk</id><content type="html" xml:base="https://royfrancis.com/fast-ld-computation-from-vcf-files-using-tomahawk/"><![CDATA[<p>Install <strong>tomahawk</strong> from <a href="https://github.com/mklarqvist/tomahawk">here</a>. Following commands are run on the Linux command-line.</p>

<h2 id="thinning-vcf">Thinning VCF</h2>

<p>For LD computation, pairwise comparisons are performed between all SNPs, therefore it is essential to thin down the number of SNPs. My dataset has about 18 million SNPs. My aim is to bring it down to 20,000 or so. Use <strong>vcftools</strong> to thin down a VCF file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vcftools <span class="nt">--vcf</span> snp.vcf <span class="nt">--recode</span> <span class="nt">--recode-INFO-all</span> <span class="nt">--thin</span> 50000 <span class="nt">--out</span> <span class="s2">"snp-thin"</span>

VCFtools - 0.1.15
<span class="o">(</span>C<span class="o">)</span> Adam Auton and Anthony Marcketta 2009

Parameters as interpreted:
        <span class="nt">--vcf</span> snp.vcf
        <span class="nt">--recode-INFO-all</span>
        <span class="nt">--thin</span> 50000
        <span class="nt">--out</span> snp-thin
        <span class="nt">--recode</span>

After filtering, kept 64 out of 64 Individuals
Outputting VCF file...
After filtering, kept 26205 out of a possible 18793942 Sites
Run Time <span class="o">=</span> 135.00 seconds

<span class="nb">mv</span> <span class="s2">"snp-thin.recode.vcf"</span> <span class="s2">"snp-thin.vcf"</span>
</code></pre></div></div>

<p>The argument <code class="language-plaintext highlighter-rouge">--thin 50000</code> means to keep 1 SNP every 50,000 bases. Depending on the number of SNPs in the VCF file, you want to increase or decrease this. I am aiming for about 20,000 or so SNPs in the thinned file.</p>

<h2 id="vcf-to-bcf">VCF to BCF</h2>

<p>Convert VCF to BCF.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bcftools view snp.vcf <span class="nt">-O</span> b <span class="nt">-o</span> snp.bcf
</code></pre></div></div>

<h2 id="tomahawk">Tomahawk</h2>

<p>Instructions on using <strong>tomahawk</strong> is detailed <a href="https://github.com/mklarqvist/tomahawk">here</a>. Convert BCF to the tomahawk format. Import filters filter out sites with missingness &gt; 20% and HW p-value &lt; 0.001.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tomahawk import <span class="nt">-i</span> snp.bcf <span class="nt">-o</span> snp <span class="nt">-m</span> 0.2 <span class="nt">-h</span> 0.001
</code></pre></div></div>

<p><strong>Tomahawk</strong> is used to compute LD.</p>

<p>Arguments: <code class="language-plaintext highlighter-rouge">-u</code> (unphased), <code class="language-plaintext highlighter-rouge">-d</code> (progress), <code class="language-plaintext highlighter-rouge">-f</code> (fast computation), <code class="language-plaintext highlighter-rouge">-i</code> (input file), <code class="language-plaintext highlighter-rouge">-o</code> (output file name prefix), <code class="language-plaintext highlighter-rouge">-r</code> (min R2 cut-off). See tomahawk <a href="https://www.biostars.org/p/347796/(https://github.com/mklarqvist/tomahawk)">help</a> for more descriptions.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tomahawk calc <span class="nt">-udfi</span> snp.twk <span class="nt">-o</span> snp <span class="nt">-a</span> 5 <span class="nt">-r</span> 0.1 <span class="nt">-P</span> 0.1 <span class="nt">-C</span> 1 <span class="nt">-t</span> 1
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">.two</code> output is binary and needs to be exported to a text file. The <code class="language-plaintext highlighter-rouge">-I</code> arguments restricts the output to a specified chromosome. So, <code class="language-plaintext highlighter-rouge">-I chr1</code> (UCSC) of <code class="language-plaintext highlighter-rouge">-I 1</code> (Ensembl) exports only chromosome 1. It is probably better to have separate files for each chromosome as the files are a more managable size to read into R. The LD metrics are computed between SNPs within chromosomes anyway.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tomahawk view <span class="nt">-i</span> snp.two <span class="o">&gt;</span> snp.ld
tomahawk view <span class="nt">-i</span> snp.two <span class="nt">-I</span> 1 <span class="o">&gt;</span> snp-1.ld
</code></pre></div></div>

<h2 id="plotting">Plotting</h2>

<p>Now we move into <strong>R</strong>. First we load some libraries and define some plotting functions to be used later.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load libraries</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">

</span><span class="c1"># define plotting functions</span><span class="w">
</span><span class="cd">#' @title plotPairwiseLD</span><span class="w">
</span><span class="cd">#' @description Plots R2 heatmap across the chromosome (like Haploview)</span><span class="w">
</span><span class="cd">#' @param dfr A data.frame with minimum CHROM_A, POS_A, CHROM_B, POS_B and R2.</span><span class="w">
</span><span class="cd">#' An output from tomahawk works.</span><span class="w">
</span><span class="cd">#' @param chr A chromosome name.</span><span class="w">
</span><span class="cd">#' @param xlim A two number vector specifying min and max x-axis limits. Any one or both can be defaulted by specifying NA.</span><span class="w">
</span><span class="cd">#' @param ylim A two number vector specifying min and max y-axis limits. Any one or both can be defaulted by specifying NA.</span><span class="w">
</span><span class="cd">#' @param minr2 A value between 0 and 1. All SNPs with R2 value below this</span><span class="w">
</span><span class="cd">#' value is excluded from plot.</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="n">plotPairwiseLD</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">dfr</span><span class="p">,</span><span class="w"> </span><span class="n">chr</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w"> </span><span class="n">minr2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">missing</span><span class="p">(</span><span class="n">dfr</span><span class="p">))</span><span class="w"> </span><span class="n">stop</span><span class="p">(</span><span class="s2">"Input data.frame 'dfr' missing."</span><span class="p">)</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">missing</span><span class="p">(</span><span class="n">chr</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">ld</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">CHROM_A</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s2">"chr"</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">CHROM_B</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s2">"chr"</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">ld</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">POS_A</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">POS_B</span><span class="p">)</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">missing</span><span class="p">(</span><span class="n">minr2</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">ld</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">R2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s2">"minr2"</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="n">ld</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ld</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">arrange</span><span class="p">(</span><span class="n">R2</span><span class="p">)</span><span class="w">

  </span><span class="n">ld</span><span class="o">$</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ld</span><span class="o">$</span><span class="n">POS_A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">ld</span><span class="o">$</span><span class="n">POS_B</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ld</span><span class="o">$</span><span class="n">POS_A</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">ld</span><span class="o">$</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ld</span><span class="o">$</span><span class="n">POS_B</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ld</span><span class="o">$</span><span class="n">POS_A</span><span class="w">
  </span><span class="n">ld</span><span class="o">$</span><span class="n">r2c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cut</span><span class="p">(</span><span class="n">ld</span><span class="o">$</span><span class="n">R2</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">),</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w">
    </span><span class="s2">"0-0 - 0.2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0.2 - 0.4"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"0.4 - 0.6"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0.6 - 0.8"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"0.8 - 1.0"</span><span class="w">
  </span><span class="p">))</span><span class="w">
  </span><span class="n">ld</span><span class="o">$</span><span class="n">r2c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">ld</span><span class="o">$</span><span class="n">r2c</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="w">
    </span><span class="s2">"0-0 - 0.2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0.2 - 0.4"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"0.4 - 0.6"</span><span class="p">,</span><span class="w"> </span><span class="s2">"0.6 - 0.8"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"0.8 - 1.0"</span><span class="w">
  </span><span class="p">)))</span><span class="w">

  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r2c</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#ca0020"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#f4a582"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#d1e5f0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#67a9cf"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#2166ac"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xlim</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ylim</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">guides</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guide_legend</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"R2"</span><span class="p">,</span><span class="w"> </span><span class="n">override.aes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Chromosome (Bases)"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_bw</span><span class="p">(</span><span class="n">base_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="w">
      </span><span class="n">panel.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
      </span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">()</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="nf">return</span><span class="p">()</span><span class="w">
</span><span class="p">}</span><span class="w">


</span><span class="cd">#' @title plotDecayLD</span><span class="w">
</span><span class="cd">#' @description Plots R2 heatmap across the chromosome (like Haploview)</span><span class="w">
</span><span class="cd">#' @param dfr A data.frame with minimum CHROM_A, POS_A, CHROM_B, POS_B and R2.</span><span class="w">
</span><span class="cd">#' An output from tomahawk works.</span><span class="w">
</span><span class="cd">#' @param chr A chromosome name.</span><span class="w">
</span><span class="cd">#' @param xlim A two number vector specifying min and max x-axis limits. Any one or both can be defaulted by specifying NA.</span><span class="w">
</span><span class="cd">#' @param ylim A two number vector specifying min and max y-axis limits.  Any one or both can be defaulted by specifying NA.</span><span class="w">
</span><span class="cd">#' @param avgwin An integer specifying window size. Mean R2 is computed within windows.</span><span class="w">
</span><span class="cd">#' @param minr2 A value between 0 and 1. All SNPs with R2 value below this</span><span class="w">
</span><span class="cd">#' value is excluded from plot.</span><span class="w">
</span><span class="cd">#'</span><span class="w">
</span><span class="n">plotDecayLD</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">dfr</span><span class="p">,</span><span class="w"> </span><span class="n">chr</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w"> </span><span class="n">avgwin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">minr2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">missing</span><span class="p">(</span><span class="n">dfr</span><span class="p">))</span><span class="w"> </span><span class="n">stop</span><span class="p">(</span><span class="s2">"Input data.frame 'dfr' missing."</span><span class="p">)</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">missing</span><span class="p">(</span><span class="n">chr</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">ld</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">CHROM_A</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s2">"chr"</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">CHROM_B</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s2">"chr"</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">ld</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">POS_A</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">POS_B</span><span class="p">)</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">missing</span><span class="p">(</span><span class="n">minr2</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">ld</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">R2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="s2">"minr2"</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="n">ld</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ld</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">arrange</span><span class="p">(</span><span class="n">R2</span><span class="p">)</span><span class="w">

  </span><span class="n">ld</span><span class="o">$</span><span class="n">dist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ld</span><span class="o">$</span><span class="n">POS_B</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ld</span><span class="o">$</span><span class="n">POS_A</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">avgwin</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">ld</span><span class="o">$</span><span class="n">distc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cut</span><span class="p">(</span><span class="n">ld</span><span class="o">$</span><span class="n">dist</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">ld</span><span class="o">$</span><span class="n">dist</span><span class="p">),</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">ld</span><span class="o">$</span><span class="n">dist</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">avgwin</span><span class="p">))</span><span class="w">
    </span><span class="n">ld</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ld</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">group_by</span><span class="p">(</span><span class="n">distc</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">summarise</span><span class="p">(</span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span><span class="w"> </span><span class="n">R2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">R2</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dist</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R2</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.15</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.7</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_smooth</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xlim</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ylim</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Distance (Bases)"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">expression</span><span class="p">(</span><span class="n">LD</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="o">^</span><span class="p">{</span><span class="w">
      </span><span class="m">2</span><span class="w">
    </span><span class="p">})))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_bw</span><span class="p">(</span><span class="n">base_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="w">
      </span><span class="n">panel.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
      </span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">()</span><span class="w">
    </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="nf">return</span><span class="p">()</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Then we read the file.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ld</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s2">"snp.ld"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="w"> </span><span class="n">comment.char</span><span class="o">=</span><span class="s2">"#"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The output looks like below:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="w"> </span><span class="n">head</span><span class="p">(</span><span class="n">ld</span><span class="p">)</span><span class="w">
  </span><span class="n">FLAG</span><span class="w"> </span><span class="n">CHROM_A</span><span class="w">   </span><span class="n">POS_A</span><span class="w"> </span><span class="n">CHROM_B</span><span class="w">   </span><span class="n">POS_B</span><span class="w">   </span><span class="n">REF_REF</span><span class="w">      </span><span class="n">REF_ALT</span><span class="w">   </span><span class="n">ALT_REF</span><span class="w">
</span><span class="m">1</span><span class="w">   </span><span class="m">10</span><span class="w">       </span><span class="m">1</span><span class="w">     </span><span class="m">359</span><span class="w">       </span><span class="m">1</span><span class="w">  </span><span class="m">100777</span><span class="w"> </span><span class="m">103.00000</span><span class="w"> </span><span class="m">8.526513e-14</span><span class="w">  </span><span class="m">5.000000</span><span class="w">
</span><span class="m">2</span><span class="w">   </span><span class="m">10</span><span class="w">       </span><span class="m">1</span><span class="w">  </span><span class="m">100777</span><span class="w">       </span><span class="m">1</span><span class="w">     </span><span class="m">359</span><span class="w"> </span><span class="m">103.00000</span><span class="w"> </span><span class="m">8.526513e-14</span><span class="w">  </span><span class="m">5.000000</span><span class="w">
</span><span class="m">3</span><span class="w">    </span><span class="m">2</span><span class="w">       </span><span class="m">1</span><span class="w">     </span><span class="m">359</span><span class="w">       </span><span class="m">1</span><span class="w">  </span><span class="m">452615</span><span class="w">  </span><span class="m">97.48765</span><span class="w"> </span><span class="m">5.512354e+00</span><span class="w"> </span><span class="m">10.512354</span><span class="w">
</span><span class="m">4</span><span class="w">    </span><span class="m">2</span><span class="w">       </span><span class="m">1</span><span class="w">  </span><span class="m">452615</span><span class="w">       </span><span class="m">1</span><span class="w">     </span><span class="m">359</span><span class="w">  </span><span class="m">97.48765</span><span class="w"> </span><span class="m">5.512354e+00</span><span class="w"> </span><span class="m">10.512354</span><span class="w">
</span><span class="m">5</span><span class="w">    </span><span class="m">6</span><span class="w">       </span><span class="m">1</span><span class="w">     </span><span class="m">359</span><span class="w">       </span><span class="m">1</span><span class="w"> </span><span class="m">1454410</span><span class="w">  </span><span class="m">49.07769</span><span class="w"> </span><span class="m">5.392231e+01</span><span class="w">  </span><span class="m">1.922308</span><span class="w">
</span><span class="m">6</span><span class="w">    </span><span class="m">6</span><span class="w">       </span><span class="m">1</span><span class="w"> </span><span class="m">1454410</span><span class="w">       </span><span class="m">1</span><span class="w">     </span><span class="m">359</span><span class="w">  </span><span class="m">49.07769</span><span class="w"> </span><span class="m">5.392231e+01</span><span class="w">  </span><span class="m">1.922308</span><span class="w">
    </span><span class="n">ALT_ALT</span><span class="w">          </span><span class="n">D</span><span class="w">    </span><span class="n">Dprime</span><span class="w">         </span><span class="n">R</span><span class="w">        </span><span class="n">R2</span><span class="w">            </span><span class="n">P</span><span class="w"> </span><span class="n">ChiSqModel</span><span class="w">
</span><span class="m">1</span><span class="w"> </span><span class="m">20.00000</span><span class="w"> </span><span class="m">0.12573242</span><span class="w"> </span><span class="m">1.0000000</span><span class="w"> </span><span class="m">0.8734775</span><span class="w"> </span><span class="m">0.7629629</span><span class="w"> </span><span class="m">4.440203e-19</span><span class="w">   </span><span class="m">2.296495</span><span class="w">
</span><span class="m">2</span><span class="w"> </span><span class="m">20.00000</span><span class="w"> </span><span class="m">0.12573242</span><span class="w"> </span><span class="m">1.0000000</span><span class="w"> </span><span class="m">0.8734775</span><span class="w"> </span><span class="m">0.7629629</span><span class="w"> </span><span class="m">4.440203e-19</span><span class="w">   </span><span class="m">2.296495</span><span class="w">
</span><span class="m">3</span><span class="w"> </span><span class="m">14.48765</span><span class="w"> </span><span class="m">0.08266716</span><span class="w"> </span><span class="m">0.6574848</span><span class="w"> </span><span class="m">0.5742982</span><span class="w"> </span><span class="m">0.3298184</span><span class="w"> </span><span class="m">5.573234e-08</span><span class="w">   </span><span class="m">1.993300</span><span class="w">
</span><span class="m">4</span><span class="w"> </span><span class="m">14.48765</span><span class="w"> </span><span class="m">0.08266716</span><span class="w"> </span><span class="m">0.6574848</span><span class="w"> </span><span class="m">0.5742982</span><span class="w"> </span><span class="m">0.3298184</span><span class="w"> </span><span class="m">5.573234e-08</span><span class="w">   </span><span class="m">1.993300</span><span class="w">
</span><span class="m">5</span><span class="w"> </span><span class="m">23.07769</span><span class="w"> </span><span class="m">0.06280179</span><span class="w"> </span><span class="m">0.8070154</span><span class="w"> </span><span class="m">0.3235735</span><span class="w"> </span><span class="m">0.1046998</span><span class="w"> </span><span class="m">1.876711e-04</span><span class="w">   </span><span class="m">7.703488</span><span class="w">
</span><span class="m">6</span><span class="w"> </span><span class="m">23.07769</span><span class="w"> </span><span class="m">0.06280179</span><span class="w"> </span><span class="m">0.8070154</span><span class="w"> </span><span class="m">0.3235735</span><span class="w"> </span><span class="m">0.1046998</span><span class="w"> </span><span class="m">1.876711e-04</span><span class="w">   </span><span class="m">7.703488</span><span class="w">
  </span><span class="n">ChiSqTable</span><span class="w">
</span><span class="m">1</span><span class="w">   </span><span class="m">97.65926</span><span class="w">
</span><span class="m">2</span><span class="w">   </span><span class="m">97.65926</span><span class="w">
</span><span class="m">3</span><span class="w">   </span><span class="m">42.21675</span><span class="w">
</span><span class="m">4</span><span class="w">   </span><span class="m">42.21675</span><span class="w">
</span><span class="m">5</span><span class="w">   </span><span class="m">13.40157</span><span class="w">
</span><span class="m">6</span><span class="w">   </span><span class="m">13.40157</span><span class="w">
</span></code></pre></div></div>

<p>Plot pairwise LD plot.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plotPairwiseLD</span><span class="p">(</span><span class="n">ld</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-2022011423360333036297223670"><a href="/assets/images/posts/2018/2018-12-01-fast-ld-computation-from-vcf-files-using-tomahawk/featured.png" title="Pairwise LD plot across a chromosome.">
      <img src="/assets/images/posts/2018/2018-12-01-fast-ld-computation-from-vcf-files-using-tomahawk/featured.png" alt="ld" />
    </a>
    <figcaption>
    Pairwise LD plot across a chromosome.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297223670 a'});
</script>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plotPairwiseLD</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">minr2</span><span class="o">=</span><span class="m">0.2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972123921"><a href="/assets/images/posts/2018/2018-12-01-fast-ld-computation-from-vcf-files-using-tomahawk/2.png" title="Pairwise LD plot with a min R2 limit of 0.2.">
      <img src="/assets/images/posts/2018/2018-12-01-fast-ld-computation-from-vcf-files-using-tomahawk/2.png" alt="ld-limit" />
    </a>
    <figcaption>
    Pairwise LD plot with a min R2 limit of 0.2.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972123921 a'});
</script>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plotPairwiseLD</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">minr2</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="o">^</span><span class="m">7</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-2022011423360333036297254383"><a href="/assets/images/posts/2018/2018-12-01-fast-ld-computation-from-vcf-files-using-tomahawk/3.png" title="Pairwise LD plot with a min R2 limit of 0.2 and y-axis max limit set to 10^7.">
      <img src="/assets/images/posts/2018/2018-12-01-fast-ld-computation-from-vcf-files-using-tomahawk/3.png" alt="ld-limit-y" />
    </a>
    <figcaption>
    Pairwise LD plot with a min R2 limit of 0.2 and y-axis max limit set to 10^7.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297254383 a'});
</script>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plotDecayLD</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">minr2</span><span class="o">=</span><span class="m">0.25</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972184335"><a href="/assets/images/posts/2018/2018-12-01-fast-ld-computation-from-vcf-files-using-tomahawk/4.png" title="LD decay plot with a min R2 limit of 0.25.">
      <img src="/assets/images/posts/2018/2018-12-01-fast-ld-computation-from-vcf-files-using-tomahawk/4.png" alt="ld-limit-y-1" />
    </a>
    <figcaption>
    LD decay plot with a min R2 limit of 0.25.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972184335 a'});
</script>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plotDecayLD</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">minr2</span><span class="o">=</span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="n">avgwin</span><span class="o">=</span><span class="m">100000</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-2022011423360333036297252759"><a href="/assets/images/posts/2018/2018-12-01-fast-ld-computation-from-vcf-files-using-tomahawk/5.png" title="LD decay plot with a min R2 limit of 0.25 and R2 values averaged within 10 Kb windows.">
      <img src="/assets/images/posts/2018/2018-12-01-fast-ld-computation-from-vcf-files-using-tomahawk/5.png" alt="ld-limit-y-2" />
    </a>
    <figcaption>
    LD decay plot with a min R2 limit of 0.25 and R2 values averaged within 10 Kb windows.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297252759 a'});
</script>]]></content><author><name>Roy Francis</name></author><category term="[&quot;Code&quot;, &quot;Research&quot;]" /><category term="Genetics" /><category term="Genomics" /><category term="Linkage Disequilibirium" /><category term="NGS" /><category term="Population Genetics" /><category term="R" /><category term="SNP" /><summary type="html"><![CDATA[Fast LD computation from a VCF file using **vcftools**, **bcftools** and **tomahawk**. This avoids the use of PLINK or conversion to PLINK formats.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://royfrancis.com/assets/images/posts/2018/2018-12-01-fast-ld-computation-from-vcf-files-using-tomahawk/featured.png" /><media:content medium="image" url="https://royfrancis.com/assets/images/posts/2018/2018-12-01-fast-ld-computation-from-vcf-files-using-tomahawk/featured.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Using google maps for aerial photography</title><link href="https://royfrancis.com/using-google-maps-for-aerial-photography/" rel="alternate" type="text/html" title="Using google maps for aerial photography" /><published>2018-08-20T21:40:09+02:00</published><updated>2018-08-20T21:40:09+02:00</updated><id>https://royfrancis.com/using-google-maps-for-aerial-photography</id><content type="html" xml:base="https://royfrancis.com/using-google-maps-for-aerial-photography/"><![CDATA[<p>If you are into aerial photography, especially using a drone, then you know that it’s not easy to imagine how the world looks like from above. Composition from the air adds an extra dimension to usual level of photo composition difficulty. The most obvious choice would be to find a high point (hill, building etc) to get a sense of the landscape. When that is not good enough, we have Google Earth. Now for those of you who were paying attention to google maps, you might have noticed that google maps is now available in 3D. At least in <a href="https://medium.com/google-earth/see-a-map-of-3d-coverage-in-google-earth-bb9f22e204c4">some</a> areas and major cities. For those areas, that are available, the level of detail is stunning. The views are far superior than the blocky 3D seen previously in Google Earth. I mean, just look at this:</p>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-2022011423360333036297221929"><a href="/assets/images/posts/2018/2018-08-20-using-google-maps-for-aerial-photography/gmap.jpg" title="Aerial view in Google maps 3D looks like an open-world game.">
      <img src="/assets/images/posts/2018/2018-08-20-using-google-maps-for-aerial-photography/gmap.jpg" alt="gmap" />
    </a>
    <figcaption>
    Aerial view in Google maps 3D looks like an open-world game.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297221929 a'});
</script>

<p>This is so impressive. It looks like an open-world game. Every tree is rendered independently and probably has several thousand polygons. Now with 3D control, I can survey the area I want to photograph and compose my scene just the way I want. To show you some examples, below are some of the scenes composed in google maps and then actually photographed using a drone.</p>

<!-- image gallery using freewall and lightbox -->

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<div class="pixture-parent">
<div class="pixture-gallery">
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:334px;" id="slb-20220114233603330362972127181"> 
          <a href="/assets/images/posts/2018/2018-08-20-using-google-maps-for-aerial-photography/gallery/aerial-1.jpg">
            <img class="pixture-img" style="height:334px;" src="/assets/images/posts/2018/2018-08-20-using-google-maps-for-aerial-photography/gallery/aerial-1.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:334px;" id="slb-20220114233603330362972127181"> 
          <a href="/assets/images/posts/2018/2018-08-20-using-google-maps-for-aerial-photography/gallery/aerial-2.jpg">
            <img class="pixture-img" style="height:334px;" src="/assets/images/posts/2018/2018-08-20-using-google-maps-for-aerial-photography/gallery/aerial-2.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
      

        
        
        
        <div class="pixture-child" style="flex-basis:334px;" id="slb-20220114233603330362972127181"> 
          <a href="/assets/images/posts/2018/2018-08-20-using-google-maps-for-aerial-photography/gallery/aerial-3.jpg">
            <img class="pixture-img" style="height:334px;" src="/assets/images/posts/2018/2018-08-20-using-google-maps-for-aerial-photography/gallery/aerial-3.jpg" alt="" />
          </a>
        </div>
        
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</div>

  <figcaption>
    Examples showing google maps preview and actual drone photograph.

  </figcaption>

</div>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972127181 a'});
</script>

<p>This is brilliant because I don’t need to use up a whole battery on my drone just to find a composition. The limitation is that this detailed 3D model is not available everywhere and also does not reflect the current lighting and weather conditions. It would also be great if google maps showed us the height of the viewpoint/camera when in 3D. Another useful additional would be to somehow incorporate <a href="http://suncalc.net">SunCalc</a> into this to get the position and trajectory of the sun.</p>]]></content><author><name>Roy Francis</name></author><category term="[&quot;Photography&quot;, &quot;Travel&quot;]" /><category term="Drone" /><category term="Uppsala" /><category term="Sweden" /><summary type="html"><![CDATA[Using google maps 3D for drone photography composition. Google maps 3D can be a useful tool to help you find the right composition in advance when planning a drone shoot.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://royfrancis.com/assets/images/posts/2018/2018-08-20-using-google-maps-for-aerial-photography/featured.jpg" /><media:content medium="image" url="https://royfrancis.com/assets/images/posts/2018/2018-08-20-using-google-maps-for-aerial-photography/featured.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Calendar plot shiny app and dynamic UI</title><link href="https://royfrancis.com/calendar-plot-shiny-app-and-dynamic-ui/" rel="alternate" type="text/html" title="Calendar plot shiny app and dynamic UI" /><published>2018-08-12T22:10:52+02:00</published><updated>2018-08-12T22:10:52+02:00</updated><id>https://royfrancis.com/calendar-plot-shiny-app-and-dynamic-ui</id><content type="html" xml:base="https://royfrancis.com/calendar-plot-shiny-app-and-dynamic-ui/"><![CDATA[<p>In my <a href="http://www.roymfrancis.com/calendar-plot-with-ggplot2/">previous post</a>, I created a calendar planner plot using ggplot2. I wanted to take it further and create a shiny app for it. This was more of a shiny learning exercise rather than a purpose-driven app. Specifically, creating dynamic user inputs and retrieving data from these inputs.</p>

<p>The app looks like this:</p>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972123966"><a href="/assets/images/posts/2018/2018-08-12-calendar-plot-shiny-app-and-dynamic-ui/featured.png" title="App preview">
      <img src="/assets/images/posts/2018/2018-08-12-calendar-plot-shiny-app-and-dynamic-ui/featured.png" alt="preview" />
    </a>
    <figcaption>
    App preview

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972123966 a'});
</script>

<p>So I had my core plotting code from the <a href="http://www.roymfrancis.com/calendar-plot-with-ggplot2/">previous post</a>, and then I created user interfaces around it. The layout is simple; there is a panel on the left with input widgets and the panel on the right displays the plot. The app takes in user input for a date span (start and end duration) and a data.frame is created expanding that span to a sequence of dates.</p>

<p>I wanted the start date duration and end date duration widgets to be side-by-side in one row, and therefore, I have used custom divs. For date input, I have set the default start date to be today’s date and end date to be 30 days from today.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">div</span><span class="p">(</span><span class="n">class</span><span class="o">=</span><span class="s2">"row"</span><span class="p">,</span><span class="w">
    </span><span class="n">div</span><span class="p">(</span><span class="n">class</span><span class="o">=</span><span class="s2">"col-md-6"</span><span class="p">,</span><span class="w"> </span><span class="n">dateInput</span><span class="p">(</span><span class="s2">"in_duration_date_start"</span><span class="p">,</span><span class="w"> </span><span class="s2">"From"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="n">Sys.time</span><span class="p">(),</span><span class="w"> </span><span class="s2">"%Y-%m-%d"</span><span class="p">,</span><span class="w"> </span><span class="n">tz</span><span class="o">=</span><span class="s2">"Europe/Stockholm"</span><span class="p">),</span><span class="w"> </span><span class="s2">"%Y-%m-%d"</span><span class="p">))),</span><span class="w">
    </span><span class="n">div</span><span class="p">(</span><span class="n">class</span><span class="o">=</span><span class="s2">"col-md-6"</span><span class="p">,</span><span class="w"> </span><span class="n">dateInput</span><span class="p">(</span><span class="s2">"in_duration_date_end"</span><span class="p">,</span><span class="s2">"To"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="n">format</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="n">Sys.time</span><span class="p">(),</span><span class="w"> </span><span class="s2">"%Y-%m-%d"</span><span class="p">,</span><span class="w"> </span><span class="n">tz</span><span class="o">=</span><span class="s2">"Europe/Stockholm"</span><span class="p">)</span><span class="m">+30</span><span class="p">,</span><span class="w"> </span><span class="s2">"%Y-%m-%d"</span><span class="p">)))</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Then the user adds more date spans to define various activities. I call these tracks. Rather than setting up a pre-defined number of tracks, I wanted to let the user choose the number of tracks. And each track will have some track parameters. I have defined a track name, start date, end date and a colour for the track. This called for a bit more complex code. The track inputs are dynamically created in a loop depending on the number of tracks set by the user.</p>

<p>The code that generates the track input user-interface (UI) dynamically looks like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output</span><span class="o">$</span><span class="n">tracks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderUI</span><span class="p">({</span><span class="w">
  </span><span class="n">num_tracks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">in_num_tracks</span><span class="p">)</span><span class="w">

  </span><span class="c1"># create date intervals</span><span class="w">
  </span><span class="n">dseq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">in_duration_date_start</span><span class="p">),</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">in_duration_date_end</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w">
  </span><span class="n">r1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">cut</span><span class="p">(</span><span class="n">dseq</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="n">num_tracks</span><span class="m">+1</span><span class="p">)))</span><span class="w">

  </span><span class="n">lapply</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">num_tracks</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">

    </span><span class="n">div</span><span class="p">(</span><span class="n">class</span><span class="o">=</span><span class="s2">"row"</span><span class="p">,</span><span class="w">
        </span><span class="n">div</span><span class="p">(</span><span class="n">class</span><span class="o">=</span><span class="s2">"col-xs-3"</span><span class="p">,</span><span class="w"> </span><span class="n">style</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="s2">"padding-right: 3px;"</span><span class="p">),</span><span class="w"> </span><span class="n">textInput</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"in_track_name_"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s2">"Name"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Text"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">placeholder</span><span class="o">=</span><span class="s2">"Available"</span><span class="p">)),</span><span class="w">
        </span><span class="n">div</span><span class="p">(</span><span class="n">class</span><span class="o">=</span><span class="s2">"col-xs-3"</span><span class="p">,</span><span class="w"> </span><span class="n">style</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="s2">"padding-right: 3px; padding-left: 3px;"</span><span class="p">),</span><span class="w">  </span><span class="n">dateInput</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"in_track_date_start_"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s2">"From"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="n">as.Date</span><span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="s2">"%Y-%m-%d"</span><span class="p">))),</span><span class="w">
        </span><span class="n">div</span><span class="p">(</span><span class="n">class</span><span class="o">=</span><span class="s2">"col-xs-3"</span><span class="p">,</span><span class="w"> </span><span class="n">style</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="s2">"padding-right: 3px; padding-left: 3px;"</span><span class="p">),</span><span class="w"> </span><span class="n">dateInput</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"in_track_date_end_"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s2">"To"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="n">as.Date</span><span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="n">i</span><span class="m">+1</span><span class="p">],</span><span class="w"> </span><span class="s2">"%Y-%m-%d"</span><span class="p">)</span><span class="m">-1</span><span class="p">)),</span><span class="w"> 
        </span><span class="n">div</span><span class="p">(</span><span class="n">class</span><span class="o">=</span><span class="s2">"col-xs-3"</span><span class="p">,</span><span class="w"> </span><span class="n">style</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="s2">"padding-left: 3px;"</span><span class="p">),</span><span class="w"> </span><span class="n">colourpicker</span><span class="o">::</span><span class="n">colourInput</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"in_track_colour_"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s2">"Colour"</span><span class="p">,</span><span class="w"> </span><span class="n">palette</span><span class="o">=</span><span class="s2">"limited"</span><span class="p">,</span><span class="w"> </span><span class="n">allowedCols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">})</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre></div></div>

<p>This looks like this in action:</p>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-2022011423360333036297226427">
    <a href="/assets/images/posts/2018/2018-08-12-calendar-plot-shiny-app-and-dynamic-ui/tracks.gif">
      <img src="/assets/images/posts/2018/2018-08-12-calendar-plot-shiny-app-and-dynamic-ui/tracks.gif" alt="tracks" />
    </a>
  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297226427 a'});
</script>

<p>Based on the number of input tracks, the date duration span is split into equal intervals by default. The start and end dates of the intervals are used as the default spans for track dates. Default colours are also selected by looping through a pre-defined colour vector.</p>

<p>A core function takes in all the plot related input to create the plot and returns a ggplot2 object. This function is called by the <code class="language-plaintext highlighter-rouge">renderImage()</code> function that creates the preview plot and also by the download plot handler. Inside the core function, a loop is also used to read the input track parameters back. The relevant part of the code looks like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_tracks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">input</span><span class="o">$</span><span class="n">in_num_tracks</span><span class="w">
</span><span class="n">track_cols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">num_tracks</span><span class="p">)</span><span class="w">
</span><span class="n">tracks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">num_tracks</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">num_tracks</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="n">temp_start_date</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"input$in_track_date_start_"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)))))</span><span class="w">
  </span><span class="n">temp_end_date</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"input$in_track_date_end_"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)))))</span><span class="w">
  </span><span class="n">temp_track_name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"input$in_track_name_"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">))))</span><span class="w">
  </span><span class="n">temp_track_col</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"input$in_track_colour_"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">))))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>I have only focused on the exciting bit of code that is new to me. The full code is available at this <a href="https://github.com/royfrancis/shiny-planner">GitHub repo</a>. A demo of this app is available at this <a href="https://roymf.shinyapps.io/calendar_planner/">shinyapps.io link</a>. This link may not always be active.</p>]]></content><author><name>Roy Francis</name></author><category term="[&quot;Code&quot;]" /><category term="Calendar" /><category term="Data Visualisation" /><category term="ggplot2" /><category term="R" /><category term="Shiny App" /><summary type="html"><![CDATA[Create an interactive calendar plot in R using Shiny.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://royfrancis.com/assets/images/posts/2018/2018-08-12-calendar-plot-shiny-app-and-dynamic-ui/featured.png" /><media:content medium="image" url="https://royfrancis.com/assets/images/posts/2018/2018-08-12-calendar-plot-shiny-app-and-dynamic-ui/featured.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Calendar plot with ggplot2</title><link href="https://royfrancis.com/calendar-plot-with-ggplot2/" rel="alternate" type="text/html" title="Calendar plot with ggplot2" /><published>2018-08-04T09:28:30+02:00</published><updated>2018-08-04T09:28:30+02:00</updated><id>https://royfrancis.com/calendar-plot-with-ggplot2</id><content type="html" xml:base="https://royfrancis.com/calendar-plot-with-ggplot2/"><![CDATA[<p>So, someone asked me about my summer time availability at work. I realized that my availability was a bit complex and perhaps it was easier to sent a figure/diagram rather than explaining it in 200 words. That’s where I thought of the idea of creating an availability calendar using ggplot2. The idea is to show basically three categories: available, not available and a limited period (where I am not available in person, but can read emails).</p>

<p>First, we prepare the general date range as a <code class="language-plaintext highlighter-rouge">data.frame</code>. Character dates are converted to date format. Then day, week, month and date are extracted from that as separate columns for ease of plotting.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># prepare date range</span><span class="w">
</span><span class="n">dfr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="s1">'2018-06-11'</span><span class="p">),</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="s1">'2018-08-12'</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">dfr</span><span class="o">$</span><span class="n">day</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">strftime</span><span class="p">(</span><span class="n">dfr</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="o">=</span><span class="s2">"%a"</span><span class="p">),</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="n">rev</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Mon"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Tue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Wed"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Thu"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Fri"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Sat"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Sun"</span><span class="p">)))</span><span class="w">
</span><span class="n">dfr</span><span class="o">$</span><span class="n">week</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">strftime</span><span class="p">(</span><span class="n">dfr</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="o">=</span><span class="s2">"%V"</span><span class="p">))</span><span class="w">
</span><span class="n">dfr</span><span class="o">$</span><span class="n">month</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">strftime</span><span class="p">(</span><span class="n">dfr</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="o">=</span><span class="s2">"%B"</span><span class="p">),</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"June"</span><span class="p">,</span><span class="w"> </span><span class="s2">"July"</span><span class="p">,</span><span class="w"> </span><span class="s2">"August"</span><span class="p">))</span><span class="w">
</span><span class="n">dfr</span><span class="o">$</span><span class="n">ddate</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">strftime</span><span class="p">(</span><span class="n">dfr</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="o">=</span><span class="s2">"%d"</span><span class="p">))</span><span class="w">

</span><span class="o">&gt;</span><span class="w"> </span><span class="n">head</span><span class="p">(</span><span class="n">dfr</span><span class="p">)</span><span class="w">
        </span><span class="n">date</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="n">week</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="n">ddate</span><span class="w">
</span><span class="m">1</span><span class="w"> </span><span class="m">2018-06-11</span><span class="w"> </span><span class="n">Mon</span><span class="w">   </span><span class="m">24</span><span class="w">  </span><span class="n">June</span><span class="w">    </span><span class="m">11</span><span class="w">
</span><span class="m">2</span><span class="w"> </span><span class="m">2018-06-12</span><span class="w"> </span><span class="n">Tue</span><span class="w">   </span><span class="m">24</span><span class="w">  </span><span class="n">June</span><span class="w">    </span><span class="m">12</span><span class="w">
</span><span class="m">3</span><span class="w"> </span><span class="m">2018-06-13</span><span class="w"> </span><span class="n">Wed</span><span class="w">   </span><span class="m">24</span><span class="w">  </span><span class="n">June</span><span class="w">    </span><span class="m">13</span><span class="w">
</span><span class="m">4</span><span class="w"> </span><span class="m">2018-06-14</span><span class="w"> </span><span class="n">Thu</span><span class="w">   </span><span class="m">24</span><span class="w">  </span><span class="n">June</span><span class="w">    </span><span class="m">14</span><span class="w">
</span><span class="m">5</span><span class="w"> </span><span class="m">2018-06-15</span><span class="w"> </span><span class="n">Fri</span><span class="w">   </span><span class="m">24</span><span class="w">  </span><span class="n">June</span><span class="w">    </span><span class="m">15</span><span class="w">
</span><span class="m">6</span><span class="w"> </span><span class="m">2018-06-16</span><span class="w"> </span><span class="n">Sat</span><span class="w">   </span><span class="m">24</span><span class="w">  </span><span class="n">June</span><span class="w">    </span><span class="m">16</span><span class="w">
</span></code></pre></div></div>

<p>Then we add our tracks to define availability into a new column named comment. We first set all comments to “Available” and then overwrite the ranges based on our availability. I have also added weekend as a category so it can be coloured differently.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># add date tracks</span><span class="w">
</span><span class="n">dfr</span><span class="o">$</span><span class="n">comment</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Available"</span><span class="w">
</span><span class="n">dfr</span><span class="o">$</span><span class="n">comment</span><span class="p">[</span><span class="n">dfr</span><span class="o">$</span><span class="n">date</span><span class="o">&gt;=</span><span class="n">as.Date</span><span class="p">(</span><span class="s1">'2018-06-11'</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">dfr</span><span class="o">$</span><span class="n">date</span><span class="o">&lt;=</span><span class="n">as.Date</span><span class="p">(</span><span class="s1">'2018-06-20'</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Limited"</span><span class="w">
</span><span class="n">dfr</span><span class="o">$</span><span class="n">comment</span><span class="p">[</span><span class="n">dfr</span><span class="o">$</span><span class="n">date</span><span class="o">&gt;=</span><span class="n">as.Date</span><span class="p">(</span><span class="s1">'2018-06-21'</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">dfr</span><span class="o">$</span><span class="n">date</span><span class="o">&lt;=</span><span class="n">as.Date</span><span class="p">(</span><span class="s1">'2018-06-29'</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Not available"</span><span class="w">
</span><span class="n">dfr</span><span class="o">$</span><span class="n">comment</span><span class="p">[</span><span class="n">dfr</span><span class="o">$</span><span class="n">date</span><span class="o">&gt;=</span><span class="n">as.Date</span><span class="p">(</span><span class="s1">'2018-07-09'</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">dfr</span><span class="o">$</span><span class="n">date</span><span class="o">&lt;=</span><span class="n">as.Date</span><span class="p">(</span><span class="s1">'2018-07-13'</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Not available"</span><span class="w">
</span><span class="n">dfr</span><span class="o">$</span><span class="n">comment</span><span class="p">[</span><span class="n">dfr</span><span class="o">$</span><span class="n">date</span><span class="o">&gt;=</span><span class="n">as.Date</span><span class="p">(</span><span class="s1">'2018-08-06'</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">dfr</span><span class="o">$</span><span class="n">date</span><span class="o">&lt;=</span><span class="n">as.Date</span><span class="p">(</span><span class="s1">'2018-08-10'</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Not available"</span><span class="w">
</span><span class="n">dfr</span><span class="o">$</span><span class="n">comment</span><span class="p">[</span><span class="n">dfr</span><span class="o">$</span><span class="n">day</span><span class="o">==</span><span class="s2">"Sat"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dfr</span><span class="o">$</span><span class="n">day</span><span class="o">==</span><span class="s2">"Sun"</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Weekend"</span><span class="w">
</span></code></pre></div></div>

<p>Then I convert the comment column into a factor with custom level order. This order determines the order in which the labels will be shown in the plot legend.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dfr</span><span class="o">$</span><span class="n">comment</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">dfr</span><span class="o">$</span><span class="n">comment</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Available"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Limited"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Not available"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Weekend"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Finally, the plotting. Columns week and day are used to define x and y axes. <code class="language-plaintext highlighter-rouge">geom_tile()</code> creates the blocks and colours for each day. <code class="language-plaintext highlighter-rouge">facet_grid()</code>  is used to separate months. <code class="language-plaintext highlighter-rouge">scale_fill_manual()</code> is used to assign custom colours. <code class="language-plaintext highlighter-rouge">theme_bw()</code> and <code class="language-plaintext highlighter-rouge">theme()</code> are used for fine adjustment of plot layout.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># plot</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">dfr</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">week</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">day</span><span class="p">))</span><span class="o">+</span><span class="w">
 </span><span class="n">geom_tile</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">comment</span><span class="p">))</span><span class="o">+</span><span class="w">
 </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">ddate</span><span class="p">))</span><span class="o">+</span><span class="w">
 </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#8dd3c7"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#ffffb3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fb8072"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#d3d3d3"</span><span class="p">))</span><span class="o">+</span><span class="w">
 </span><span class="n">facet_grid</span><span class="p">(</span><span class="o">~</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="o">=</span><span class="s2">"free"</span><span class="p">,</span><span class="w"> </span><span class="n">space</span><span class="o">=</span><span class="s2">"free"</span><span class="p">)</span><span class="o">+</span><span class="w">
 </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Week"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="o">+</span><span class="w">
 </span><span class="n">theme_bw</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="o">+</span><span class="w">
 </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.title</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> 
       </span><span class="n">panel.grid</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> 
       </span><span class="n">panel.border</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> 
       </span><span class="n">axis.ticks</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> 
       </span><span class="n">strip.background</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> 
       </span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"top"</span><span class="p">,</span><span class="w"> 
       </span><span class="n">legend.justification</span><span class="o">=</span><span class="s2">"right"</span><span class="p">,</span><span class="w"> 
       </span><span class="n">legend.direction</span><span class="o">=</span><span class="s2">"horizontal"</span><span class="p">,</span><span class="w"> 
       </span><span class="n">legend.key.size</span><span class="o">=</span><span class="n">unit</span><span class="p">(</span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">),</span><span class="w"> 
       </span><span class="n">legend.spacing.x</span><span class="o">=</span><span class="n">unit</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>And then save the plot.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggsave</span><span class="p">(</span><span class="s2">"calendar.png"</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="o">=</span><span class="s2">"cm"</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="o">=</span><span class="m">300</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"cairo"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972153113"><a href="/assets/images/posts/2018/2018-08-04-calendar-plot-with-ggplot2/featured.png" title="Availability calendar plot in R using ggplot2.">
      <img src="/assets/images/posts/2018/2018-08-04-calendar-plot-with-ggplot2/featured.png" alt="featured" />
    </a>
    <figcaption>
    Availability calendar plot in R using ggplot2.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972153113 a'});
</script>

<p>And we have our finished calendar. The custom font I used in the plot is called <a href="https://gidole.github.io/">Gidole</a>. To use custom fonts, import the font using library <code class="language-plaintext highlighter-rouge">extrafont</code> . Then in <code class="language-plaintext highlighter-rouge">theme_bw()</code> , set <code class="language-plaintext highlighter-rouge">base_family="Gidole"</code> . Also in <code class="language-plaintext highlighter-rouge">geom_text()</code> , set <code class="language-plaintext highlighter-rouge">family="Gidole"</code> .</p>]]></content><author><name>Roy Francis</name></author><category term="[&quot;Code&quot;]" /><category term="Calendar" /><category term="Data Visualisation" /><category term="ggplot2" /><category term="R" /><summary type="html"><![CDATA[Creating an availability calendar plot using ggplot2 in R.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://royfrancis.com/assets/images/posts/2018/2018-08-04-calendar-plot-with-ggplot2/featured.png" /><media:content medium="image" url="https://royfrancis.com/assets/images/posts/2018/2018-08-04-calendar-plot-with-ggplot2/featured.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>