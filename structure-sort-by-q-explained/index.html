<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Structure ‘Sort by Q’ explained • rmf</title>
<meta name="description" content="STRUCTURE is a popular software used by biologists to infer the population structure of organisms using genetic markers. Barplots in STRUCTURE have an option to sort individuals by Q. We explore the ‘Sort by Q’ option using R and Excel to figure out what it does.">


  <meta name="author" content="Roy Francis">
  
  <meta property="article:author" content="Roy Francis">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="rmf">
<meta property="og:title" content="Structure ‘Sort by Q’ explained">
<meta property="og:url" content="https://royfrancis.com/structure-sort-by-q-explained/">


  <meta property="og:description" content="STRUCTURE is a popular software used by biologists to infer the population structure of organisms using genetic markers. Barplots in STRUCTURE have an option to sort individuals by Q. We explore the ‘Sort by Q’ option using R and Excel to figure out what it does.">







  <meta property="article:published_time" content="2015-12-14T08:43:30+01:00">





  

  


<link rel="canonical" href="https://royfrancis.com/structure-sort-by-q-explained/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Roy Francis",
      "url": "https://royfrancis.com/"
    
  }
</script>


  <meta name="google-site-verification" content="google-site-verification=gVz_q-4FyIIzjgUOs8-zItaFtLDCqCLhiHAAfkGb808" />






<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="rmf Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->




    <link rel="apple-touch-icon"  type="image/png"   sizes="180x180"   href="/assets/images/apple-touch-icon.png">

    <link rel="icon"  type="image/png"   sizes="48x48"   href="/assets/images/favicon-48x48.png">

    <link rel="icon"  type="image/png"   sizes="32x32"   href="/assets/images/favicon-32x32.png">

    <link rel="icon"  type="image/png"   sizes="16x16"   href="/assets/images/favicon-16x16.png">

    <link rel="shortcut icon"   sizes="2"   href="/assets/images/favicon.ico">

    <link rel="manifest"   sizes="2"   href="/assets/images/site.webmanifest">

    <link rel="mask-icon"   sizes="3"   color="#5bbad5"  href="/assets/images/safari-pinned-tab.svg">



<meta name="msapplication-config" content="/assets/images/browserconfig.xml">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<link href="https://fonts.googleapis.com/css?family=Merriweather:400,700|Source+Sans+Pro:400,400i,600|Ubuntu+Mono&display=swap&subset=latin-ext" rel="stylesheet" type="text/css">

<!-- end custom head snippets -->




    <script src="/assets/js/simplelightbox.js"></script>

    <script src="/assets/js/code-copy.js"></script>



    <link href="/assets/css/simplelightbox.css" rel="stylesheet">

  </head>

  <body class="layout--single-mx wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/android-chrome-192x192.png" alt="rmf"></a>
        
        <a class="site-title" href="/">
          rmf
          <span class="site-subtitle">Code, Photography, Design</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/posts/">Blog</a>
            </li><li class="masthead__menu-item">
              <a href="/projects/">Projects</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="parent-container">
      <div class="initial-content">
        



<div class="featured">
  <img src=/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/featured.png alt="featured-image" class="featured-image">
</div>



<div id="main-mx" role="main">
  


  <article class="page-mx h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    
    <meta itemprop="headline" content="Structure ‘Sort by Q’ explained">
    
    <meta itemprop="description" content="STRUCTURE is a popular software used by biologists to infer the population structure of organisms using genetic markers. Barplots in STRUCTURE have an option to sort individuals by Q. We explore the ‘Sort by Q’ option using R and Excel to figure out what it does.">
    
    <meta itemprop="datePublished" content="2015-12-14T08:43:30+01:00">
    

    <div class="page__inner-wrap">
      
      <header>
        <h1 id="page-title" class="page__title p-name" itemprop="headline">
          <a href="https://royfrancis.com/structure-sort-by-q-explained/" class="u-url" itemprop="url">Structure ‘Sort by Q’ explained
</a>
        </h1>
        


      </header>
      

      <section class="page__content e-content" itemprop="text">

        <footer class="page__meta">
          
          <div class="meta-content">
  <div class="meta-content-sub">
  

  <span class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> </strong> <time class="dt-published" datetime="2015-12-14T08:43:30+01:00">14 Dec 2015</time></span>

  
  <span class="separator">
    •
  </span>
  
  
  


  

  <span>
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i>  </strong>
    <span itemprop="keywords" class="category-keywords">
    
      <a href="/categories/#code" class="page__taxonomy-item p-category taxonomy-category" rel="tag">Code</a><span class="sep">, </span>
    
      <a href="/categories/#research" class="page__taxonomy-item p-category taxonomy-category" rel="tag">Research</a>
    
    </span>
  </span>


</div>  
  
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i>  </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#population-genetics" class="page__taxonomy-item p-category taxonomy-tag" rel="tag">Population Genetics</a><span class="sep">, </span>
    
      <a href="/tags/#r" class="page__taxonomy-item p-category taxonomy-tag" rel="tag">R</a><span class="sep">, </span>
    
      <a href="/tags/#scientific-graphs" class="page__taxonomy-item p-category taxonomy-tag" rel="tag">Scientific Graphs</a>
    
    </span>
  </p>


</div>
        </footer>

        
        <div class="article-content">
          <p>I currently use STRUCTURE 2.3.4 on Windows. A typical assignment output file for <em>K</em>=2 looks like below. <a href="structure-file.txt">Here</a> is the structure file I use.</p>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972103509"><a href="/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/structure-file.png" title="&lt;b&gt;Fig.1:&lt;/b&gt; A typical Structure assignment output.">
      <img src="/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/structure-file.png" alt="structure-file" />
    </a>
    <figcaption>
    <b>Fig.1:</b> A typical Structure assignment output.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972103509 a'});
</script>

<p>We can use the plotting functionality within STRUCTURE to view the assignment results as a barplot. See fig below. The individuals are ordered in the same order as the input file when selecting the ‘Original order’ option. There is another option to sort individuals called ‘Sort by Q’. What does this actually do?</p>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972174073"><a href="/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/bp-structure-unsorted.png" title="&lt;b&gt;Fig.2:&lt;/b&gt; Barplot in STRUCTURE software showing original order of individuals (top) and 'Sort by Q' order (bottom).">
      <img src="/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/bp-structure-unsorted.png" alt="bp-structure-unsorted" />
    </a>
    <figcaption>
    <b>Fig.2:</b> Barplot in STRUCTURE software showing original order of individuals (top) and ‘Sort by Q’ order (bottom).

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972174073 a'});
</script>

<p>One might reasonably assume that the individuals are sorted by one of the assignment clusters. But, that is not the case. We will try to plot the data manually and investigate this option. The structure output file used can be downloaded <a href="structure-file.txt">here</a>. This is the same as that linked earlier.</p>

<p>We use the R package <code class="language-plaintext highlighter-rouge">pophelper</code> to convert structure files to R dataframe, <code class="language-plaintext highlighter-rouge">ggplot</code> package for plotting and <code class="language-plaintext highlighter-rouge">reshape2</code> package for data restructuring. The data is read into R as a dataframe with two columns Cluster1 and Cluster2 with assignment values.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#install pophelper library</span><span class="w">
</span><span class="c1">#library(devtools)</span><span class="w">
</span><span class="c1">#install_github('royfrancis/pophelper')</span><span class="w">

</span><span class="c1">#load packages</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">pophelper</span><span class="p">)</span><span class="w">

</span><span class="c1">#read data to dataframe</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readQ</span><span class="p">(</span><span class="s2">"structure-file.txt"</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">


</span><span class="o">&gt;</span><span class="w"> </span><span class="n">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="n">Cluster1</span><span class="w"> </span><span class="n">Cluster2</span><span class="w">
</span><span class="m">1</span><span class="w"> </span><span class="m">0.965</span><span class="w"> </span><span class="m">0.035</span><span class="w">
</span><span class="m">2</span><span class="w"> </span><span class="m">0.977</span><span class="w"> </span><span class="m">0.023</span><span class="w">
</span><span class="m">3</span><span class="w"> </span><span class="m">0.961</span><span class="w"> </span><span class="m">0.039</span><span class="w">
</span><span class="m">4</span><span class="w"> </span><span class="m">0.975</span><span class="w"> </span><span class="m">0.025</span><span class="w">
</span><span class="m">5</span><span class="w"> </span><span class="m">0.974</span><span class="w"> </span><span class="m">0.026</span><span class="w">
</span><span class="m">6</span><span class="w"> </span><span class="m">0.982</span><span class="w"> </span><span class="m">0.018</span><span class="w">
</span></code></pre></div></div>

<p>Now we create a function to create the plot.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#create function to generate plots</span><span class="w">
</span><span class="n">plotfn</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="kc">NULL</span><span class="p">){</span><span class="w">
</span><span class="c1">#reshape to long format</span><span class="w">
</span><span class="n">df</span><span class="o">$</span><span class="n">num</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="n">df1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reshape2</span><span class="o">::</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">id.vars</span><span class="o">=</span><span class="s2">"num"</span><span class="p">)</span><span class="w">
</span><span class="c1">#reversing order for cosmetic reasons</span><span class="w">
</span><span class="n">df1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df1</span><span class="p">[</span><span class="n">rev</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">df1</span><span class="p">)),</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="c1">#plot</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">num</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">variable</span><span class="p">))</span><span class="o">+</span><span class="w">
</span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">space</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="o">+</span><span class="w">
</span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">expand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="o">+</span><span class="w">
</span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="o">+</span><span class="w">
</span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span><span class="o">+</span><span class="w">
</span><span class="n">theme_grey</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="m">7</span><span class="p">)</span><span class="o">+</span><span class="w">
</span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">,</span><span class="w">
</span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">())</span><span class="w">

</span><span class="n">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="o">=</span><span class="m">150</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="o">=</span><span class="s2">"cm"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">#plot unsorted plot</span><span class="w">
</span><span class="n">plotfn</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="s2">"bp-r-unsorted.png"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Here is the assignment barplot in the original order.</p>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972102147"><a href="/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/bp-r-unsorted.png" title="&lt;b&gt;Fig.3:&lt;/b&gt; Assignment barplot recreated in R. Individuals are in original order.">
      <img src="/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/bp-r-unsorted.png" alt="bp-r-unsorted" />
    </a>
    <figcaption>
    <b>Fig.3:</b> Assignment barplot recreated in R. Individuals are in original order.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972102147 a'});
</script>

<p>Now we create two plots. One figure where the table is sorted by Cluster1 and second figure where the table is sorted by Cluster2.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#sort table by cluster1</span><span class="w">
</span><span class="n">df_c1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">df</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">]),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">plotfn</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df_c1</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="s2">"bp-r-sortedc1.png"</span><span class="p">)</span><span class="w">

</span><span class="c1">#sort table by cluster2</span><span class="w">
</span><span class="n">df_c2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">df</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">]),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">plotfn</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df_c2</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="s2">"bp-r-sortedc2.png"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972142910"><a href="/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/bp-r-sortedc1.png" title="&lt;b&gt;Fig.4:&lt;/b&gt; Assignment barplot in R sorted by cluster 1.">
      <img src="/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/bp-r-sortedc1.png" alt="bp-r-sorted-c1" />
    </a>
    <figcaption>
    <b>Fig.4:</b> Assignment barplot in R sorted by cluster 1.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972142910 a'});
</script>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-20220114233603330362972195774"><a href="/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/bp-r-sortedc2.png" title="&lt;b&gt;Fig.5:&lt;/b&gt; Assignment barplot in R sorted by cluster 2.">
      <img src="/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/bp-r-sortedc2.png" alt="bp-r-sorted-c2" />
    </a>
    <figcaption>
    <b>Fig.5:</b> Assignment barplot in R sorted by cluster 2.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-20220114233603330362972195774 a'});
</script>

<p>Both of these plots do not resemble the ‘Sort by Q’ option in Structure software. They look like mirror images only because it’s <em>K</em>=2. For <em>K</em>&gt;2, they would look quite different. Anyway, the ‘Sort by Q’ option does a bit more. For each individual, the max assignment value is picked to create a new column called ‘max’. The cluster number with the max assignment is created as a new column called ‘match’. The the whole table is sorted ascending by ‘match’ and descending by ‘max’. Here is the R code.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#pick max cluster, match max to cluster</span><span class="w">
</span><span class="n">maxval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">)</span><span class="w">
</span><span class="n">matchval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="w"> </span><span class="n">matchval</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">match</span><span class="p">(</span><span class="n">maxval</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="p">])</span><span class="w">

</span><span class="c1">#add max and match to df</span><span class="w">
</span><span class="n">df_q</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w">
</span><span class="n">df_q</span><span class="o">$</span><span class="n">maxval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">maxval</span><span class="w">
</span><span class="n">df_q</span><span class="o">$</span><span class="n">matchval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matchval</span><span class="w">

</span><span class="c1">#order dataframe ascending match and decending max</span><span class="w">
</span><span class="n">df_q</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_q</span><span class="p">[</span><span class="n">with</span><span class="p">(</span><span class="n">df_q</span><span class="p">,</span><span class="w">  </span><span class="n">order</span><span class="p">(</span><span class="n">matchval</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">maxval</span><span class="p">)),</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="c1">#remove max and match</span><span class="w">
</span><span class="n">df_q</span><span class="o">$</span><span class="n">maxval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span><span class="n">df_q</span><span class="o">$</span><span class="n">matchval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">

</span><span class="c1">#plot</span><span class="w">
</span><span class="n">plotfn</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df_q</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="s2">"bp-r-sortedq.png"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>And that gives us the plot we are looking for. The same plot created in the STRUCTURE software.</p>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-2022011423360333036297229247"><a href="/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/bp-r-sortedq.png" title="&lt;b&gt;Fig.6:&lt;/b&gt; Assignment barplot in R sorted by Q.">
      <img src="/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/bp-r-sortedq.png" alt="bp-r-sorted-q" />
    </a>
    <figcaption>
    <b>Fig.6:</b> Assignment barplot in R sorted by Q.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297229247 a'});
</script>

<p>Here is also an <strong><a href="structure-plot.xlsx">Excel file</a></strong> with the calculations, if R is not your thing.</p>

<!-- https://stackoverflow.com/questions/7488393/jekyll-liquid-random-numbers -->

<figure class="fig" id="slb-2022011423360333036297246110"><a href="/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/structure-excel.png" title="&lt;b&gt;Fig.7:&lt;/b&gt; Assignment barplot and 'Sort by Q' calculation in Excel.">
      <img src="/assets/images/posts/2015/2015-12-14-structure-sort-by-q-explained/structure-excel.png" alt="structure-excel" />
    </a>
    <figcaption>
    <b>Fig.7:</b> Assignment barplot and ‘Sort by Q’ calculation in Excel.

    </figcaption>

  

</figure>

<script type="text/javascript">
  new SimpleLightbox({elements: '#slb-2022011423360333036297246110 a'});
</script>

<p>You can always verify by checking the individual number (#) with the individual numbers in the STRUCTURE software (set to ‘Plot in multiple lines’).</p>

<p>That’s all for now. I hope this was useful for all those who were as confused as I was.</p>

        </div>
        

        <div>
          <a href="#page-title" class="back-to-top">Back to top &uarr;</a>
        </div>
        
      </section>

      

      
  <nav class="pagination">
    
      <a href="/meet-bjorn-the-cat/" class="pagination--pager" title="Björn the Norwegian forest cat
">Previous</a>
    
    
      <a href="/swedish-lapland-trip/" class="pagination--pager" title="Polar adventures through Swedish Lapland
">Next</a>
    
  </nav>

    </div>

    
    <div class="page__comments">
  
  
      <h4 class="page__comments-title">Comments</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
  <div class="page-related-mx">
    <h2 class="page__related-title">You may also enjoy</h2>
    <div class="grid__wrapper">
      
      





<div class="grid__item feed-item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    
      <div class="archive-featured-small feed-image">
        <img src=/assets/images/posts/2019/2019-11-07-greece-thessaloniki/featured.jpg alt="featured-image-small" class="archive-featured-image">
      </div>

      <div class="archive-text">
        <div class="archive-meta-content">
  <div class="archive-meta-content-sub">
    
    <!-- date -->
    
    
      <span class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> </strong> <time class="dt-published feed-date" datetime="2019-11-07T00:00:00+01:00">07 Nov 2019</time></span>
    

    <!-- separator-->
    
    <span class="separator">
      •
    </span>
    

    <!-- categories -->
      
      
      
    
    
      
    
      <span>
        <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i>  </strong>
        <span itemprop="keywords" class="category-keywords feed-category">
        
          <a href="/categories/#photography" class="page__taxonomy-item p-category taxonomy-category" rel="tag">Photography</a><span class="sep">, </span>
        
          <a href="/categories/#travel" class="page__taxonomy-item p-category taxonomy-category" rel="tag">Travel</a>
        
        </span>
      </span>
    


      
      
  </div>
</div>
        <h2 class="archive__item-title no_toc feed-title" itemprop="headline">
        
          <a href="/greece-thessaloniki/" rel="permalink">Exploring history and culture in Thessaloniki
</a>
        
        </h2>
        


        <p class="archive__item-excerpt feed-excerpt" itemprop="description">A short weekend away in Thessaloniki, Greece.
</p>
      </div>
  </article>
</div>

      
      





<div class="grid__item feed-item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    
      <div class="archive-featured-small feed-image">
        <img src=/assets/images/posts/2019/2019-09-17-scatterplot-annotation/featured.jpg alt="featured-image-small" class="archive-featured-image">
      </div>

      <div class="archive-text">
        <div class="archive-meta-content">
  <div class="archive-meta-content-sub">
    
    <!-- date -->
    
    
      <span class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> </strong> <time class="dt-published feed-date" datetime="2019-09-17T00:00:00+02:00">17 Sep 2019</time></span>
    

    <!-- separator-->
    
    <span class="separator">
      •
    </span>
    

    <!-- categories -->
      
      
      
    
    
      
    
      <span>
        <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i>  </strong>
        <span itemprop="keywords" class="category-keywords feed-category">
        
          <a href="/categories/#code" class="page__taxonomy-item p-category taxonomy-category" rel="tag">Code</a><span class="sep">, </span>
        
          <a href="/categories/#research" class="page__taxonomy-item p-category taxonomy-category" rel="tag">Research</a>
        
        </span>
      </span>
    


      
      
  </div>
</div>
        <h2 class="archive__item-title no_toc feed-title" itemprop="headline">
        
          <a href="/scatterplot-annotation/" rel="permalink">Scatterplot annotation
</a>
        
        </h2>
        


        <p class="archive__item-excerpt feed-excerpt" itemprop="description">Annotating scatterplots in R. Drawing polygons around point clusters using base functions and R packages ggplot, ggalt and ggforce.
</p>
      </div>
  </article>
</div>

      
      





<div class="grid__item feed-item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    
      <div class="archive-featured-small feed-image">
        <img src=/assets/images/posts/2019/2019-08-22-sweden-west-coast/featured.jpg alt="featured-image-small" class="archive-featured-image">
      </div>

      <div class="archive-text">
        <div class="archive-meta-content">
  <div class="archive-meta-content-sub">
    
    <!-- date -->
    
    
      <span class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> </strong> <time class="dt-published feed-date" datetime="2019-08-22T00:00:00+02:00">22 Aug 2019</time></span>
    

    <!-- separator-->
    
    <span class="separator">
      •
    </span>
    

    <!-- categories -->
      
      
      
    
    
      
    
      <span>
        <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i>  </strong>
        <span itemprop="keywords" class="category-keywords feed-category">
        
          <a href="/categories/#photography" class="page__taxonomy-item p-category taxonomy-category" rel="tag">Photography</a><span class="sep">, </span>
        
          <a href="/categories/#travel" class="page__taxonomy-item p-category taxonomy-category" rel="tag">Travel</a>
        
        </span>
      </span>
    


      
      
  </div>
</div>
        <h2 class="archive__item-title no_toc feed-title" itemprop="headline">
        
          <a href="/sweden-west-coast/" rel="permalink">Exploring the Swedish west coast
</a>
        
        </h2>
        


        <p class="archive__item-excerpt feed-excerpt" itemprop="description">A road trip exploring the west coast of Sweden.
</p>
      </div>
  </article>
</div>

      
      





<div class="grid__item feed-item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    
      <div class="archive-featured-small feed-image">
        <img src=/assets/images/posts/2019/2019-06-30-portugal/featured.jpg alt="featured-image-small" class="archive-featured-image">
      </div>

      <div class="archive-text">
        <div class="archive-meta-content">
  <div class="archive-meta-content-sub">
    
    <!-- date -->
    
    
      <span class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> </strong> <time class="dt-published feed-date" datetime="2019-06-30T00:00:00+02:00">30 Jun 2019</time></span>
    

    <!-- separator-->
    
    <span class="separator">
      •
    </span>
    

    <!-- categories -->
      
      
      
    
    
      
    
      <span>
        <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i>  </strong>
        <span itemprop="keywords" class="category-keywords feed-category">
        
          <a href="/categories/#photography" class="page__taxonomy-item p-category taxonomy-category" rel="tag">Photography</a><span class="sep">, </span>
        
          <a href="/categories/#travel" class="page__taxonomy-item p-category taxonomy-category" rel="tag">Travel</a>
        
        </span>
      </span>
    


      
      
  </div>
</div>
        <h2 class="archive__item-title no_toc feed-title" itemprop="headline">
        
          <a href="/portugal/" rel="permalink">Road trip through Portugal
</a>
        
        </h2>
        


        <p class="archive__item-excerpt feed-excerpt" itemprop="description">A conference and road trip through Portugal.
</p>
      </div>
  </article>
</div>

      
    </div>
  </div>
  
  
</div>


<script>
  document
    .querySelector('.article-content')
    .querySelectorAll('pre.highlight')
    .forEach(function(pre) {
      var button = document.createElement('button');
      var copyText = 'Copy';
      button.className = 'code-copy';
      button.type = 'button';
      button.ariaLabel = 'Copy code to clipboard';
      button.innerText = copyText;
      button.addEventListener('click', function() {
        var code = pre.querySelector('code').innerText.trim();
        navigator.clipboard.writeText(code);
        button.innerText = 'Copied';
        setTimeout(function() {
          button.innerText = copyText;
        }, 4000);
      });
      //pre.appendChild(button);
      pre.insertBefore(button, pre.firstChild);
    });
</script>
      </div>
    </div>


    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2015 - 2022 Roy Francis. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-66208341-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-66208341-1', { 'anonymize_ip': true});
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://royfrancis.com/structure-sort-by-q-explained/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/structure-sort-by-q-explained"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://romf.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  





  </body>
</html>
